{
  "active": true,
  "activeVersion": {
    "updatedAt": "2026-01-02T17:56:18.837Z",
    "createdAt": "2026-01-02T17:56:18.837Z",
    "versionId": "e76dc650-ae94-4a44-8a21-cc2946f93f73",
    "workflowId": "5AkZBvuxRdmbDm8f",
    "nodes": [
      {
        "parameters": {
          "promptType": "define",
          "text": "=Whatsapp message to be splitted and formated: {{ $json.output }}",
          "hasOutputParser": true,
          "messages": {
            "messageValues": [
              {
                "message": "=Regras obrigatórias de formatação e comportamento:\n\nDivisão das mensagens\n\nA resposta deve conter no máximo 2 mensagens dentro do array \"messages\".\n\nNunca envie mais que duas.\n\nSe a mensagem for curta ou média, envie apenas uma mensagem.\n\nSó divida em duas partes se for realmente necessário, quando o texto ficar muito extenso para caber em uma única mensagem.\n\nForma de divisão\n\nSe precisar dividir, faça isso naturalmente, como se fosse uma conversa entre pessoas.\n\nA divisão deve acontecer somente no final de uma frase completa (por exemplo, após um ponto final, interrogação ou exclamação).\n\nJamais corte frases no meio.\n\nJamais gere mensagens vazias.\n\nFormatação de texto para WhatsApp\n\nUtilize apenas os estilos permitidos no WhatsApp\n\nlink → sempre mostrar o link puro\n\nExemplo correto de link:\nhttps://link.com.br/exemplo\n\nProibições\n\nNunca use markdown no estilo [texto](link) ou Texto (link).\n\nNunca use “www” em links — se detectar, remova automaticamente e mantenha apenas o formato https://."
              }
            ]
          }
        },
        "id": "d033b830-b389-4235-8393-d7e9b6176bae",
        "name": "Parser  Chain1",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.4,
        "position": [
          -736,
          720
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "vendasblack",
          "options": {}
        },
        "id": "d86cbfdb-2236-4173-b633-549cdda1949f",
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -6832,
          992
        ],
        "webhookId": "01b980a0-8dbe-4b4d-8857-2321c4c5875b"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "0cb14635-2673-408e-86db-ce9e0373674b",
                      "leftValue": "={{ $('camposIniciais').item.json.content.tipoMensagem }}",
                      "rightValue": "message",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Texto"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "485658e2-b60e-46bf-afb7-250cc1b5bb8b",
                      "leftValue": "={{ $('Webhook').item.json.body.contact.lastMessageData.messageType }}",
                      "rightValue": "image",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "imagem"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "35ed5c99-4c5f-4d98-9a23-12882f27d1a4",
                      "leftValue": "={{ $('Webhook').item.json.body.contact.lastMessageData.messageType }}",
                      "rightValue": "audio",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "audio"
              }
            ]
          },
          "options": {}
        },
        "id": "50ad7e02-4fc6-45fc-83d3-284acd4b538c",
        "name": "Switch2",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -4112,
          960
        ]
      },
      {
        "parameters": {
          "content": "## PASSO 5 - ORGANIZA E ENVIA AS MENSAGENS PARA O CLIENTE",
          "height": 674,
          "width": 2068,
          "color": 6
        },
        "id": "f8603e92-bf51-469b-88a6-e3c55072d941",
        "name": "Sticky Note11",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -928,
          448
        ]
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}"
        },
        "id": "4962462e-54b4-4b8c-9b02-7d6476d21c81",
        "name": "OutputParser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          -560,
          960
        ]
      },
      {
        "parameters": {},
        "id": "04b707b8-cb5b-477d-889d-906c3a483252",
        "name": "Replace Me1",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          16,
          800
        ]
      },
      {
        "parameters": {},
        "id": "0aefe4e8-3683-47c8-a733-13291e117a84",
        "name": "no.op2",
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          928,
          768
        ]
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "d01bb549-20c5-40ad-860b-c9d44b382034",
        "name": "Loop Over Items1",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -176,
          720
        ]
      },
      {
        "parameters": {
          "amount": 1.2
        },
        "id": "8d2b41ef-5916-44e8-8923-34001b65fccd",
        "name": "1,2s",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          768,
          784
        ],
        "webhookId": "e5987401-8b77-4a84-8693-25fd8898cd94"
      },
      {
        "parameters": {
          "fieldToSplitOut": "output.messages",
          "options": {
            "destinationFieldName": "output"
          }
        },
        "id": "4e010235-0a17-466a-a9c3-93916fd8b53f",
        "name": "Segmentos",
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -400,
          720
        ]
      },
      {
        "parameters": {
          "model": "gpt-4.1-mini",
          "options": {}
        },
        "id": "f1a9cd07-cade-4365-895a-ede51df6b593",
        "name": "OpenAI2",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          -800,
          944
        ],
        "credentials": {
          "openAiApi": {
            "id": "FWqn0IMXX1HmDrEh",
            "name": "IA SUPORTE"
          }
        }
      },
      {
        "parameters": {
          "content": "## PASSO 4 - AGENTE DE IA COM INTELIGÊNCIA E TOOLS",
          "height": 414,
          "width": 1039,
          "color": 6
        },
        "id": "fbad1222-c6b4-43d5-af0f-7b2b8620aadc",
        "name": "Sticky Note9",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -2016,
          480
        ]
      },
      {
        "parameters": {
          "content": "## PASSO 2 - CRIA USUÁRIO NO BANCO DE DADOS SUPABASE",
          "height": 766,
          "width": 923,
          "color": 6
        },
        "id": "e2433c21-cb8a-4b86-91ed-47aff4a6e64e",
        "name": "Sticky Note8",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -5328,
          624
        ]
      },
      {
        "parameters": {
          "content": "## PASSO 1 - CREDENCIAIS, DADOS, E PROMPT AGENTE",
          "height": 758,
          "width": 1479,
          "color": 6
        },
        "id": "c932d077-3a75-4dc3-b4b4-12bf27616b04",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -6864,
          624
        ]
      },
      {
        "parameters": {
          "tableId": "atendimento_wpp_vendas",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "nome",
                "fieldValue": "={{ $('camposIniciais').item.json.meta.nomeCliente }}"
              },
              {
                "fieldId": "telefone",
                "fieldValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
              },
              {
                "fieldId": "idmensagem",
                "fieldValue": "={{ $('camposIniciais').item.json.content.idMensagem }}"
              },
              {
                "fieldId": "sessionid",
                "fieldValue": "={{ $json.data }}"
              }
            ]
          }
        },
        "id": "7d94f1aa-6c02-4996-ab91-ffe2a6968aa1",
        "name": "CreateUser",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          -4752,
          1152
        ],
        "credentials": {
          "supabaseApi": {
            "id": "06funpVK0RasJnc4",
            "name": "Supabase - Fabiana Tomé"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "4e77cc7c-48f4-4cbe-94e7-6d211db67002",
                "leftValue": "={{ $('getClient').item.json.telefone }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "41d40c7b-d237-4282-ba02-701ff48957a7",
        "name": "If1",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -5072,
          992
        ]
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "atendimento_wpp_vendas",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "keyValue": "={{ $('Webhook').item.json.body.contact.phoneNumber }}"
              }
            ]
          }
        },
        "id": "9fd9e75a-6bac-4ba1-805a-92b4d5dcc295",
        "name": "getClient",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          -5248,
          992
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "supabaseApi": {
            "id": "06funpVK0RasJnc4",
            "name": "Supabase - Fabiana Tomé"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "f9ecf2fc-da2c-4f44-897a-5dc0a2f2f379",
                "name": "meta.telefoneCliente",
                "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
                "type": "string"
              },
              {
                "id": "dab7ca54-c3d2-4a36-a9ca-a0ebbd375ef5",
                "name": "meta.nomeCliente",
                "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"name\"] }}",
                "type": "string"
              },
              {
                "id": "81612acf-1b66-4c8e-82e4-ce8c77b31334",
                "name": "content.mensagem",
                "value": "={{ \n  $json.body?.content || \n\n  $json.body?.data?.message?.extendedTextMessage?.text || \n  $json.body?.data?.message?.imageMessage?.caption || \n  $json.body?.data?.message?.conversation || \n  $json?.message?.text || \n  $json?.message?.caption || \n  null \n}}",
                "type": "string"
              },
              {
                "id": "cc7dcfe1-8ad7-4fe8-93ec-8f643c7d08c7",
                "name": "content.tipoMensagem",
                "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"lastMessageData\"][\"messageType\"] }}",
                "type": "string"
              },
              {
                "id": "2dfc64f4-b222-4ea7-b095-fdd96d9fcb95",
                "name": "content.idMensagem",
                "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"id\"] }}",
                "type": "string"
              },
              {
                "id": "255b9c45-7769-4d09-9c50-61dcdfb7c09d",
                "name": "app.debouncerTime",
                "value": "20",
                "type": "string"
              },
              {
                "id": "fc7c5c8f-b505-4a43-ae07-51eea58d6f80",
                "name": "linkPreview",
                "value": false,
                "type": "boolean"
              },
              {
                "id": "e30bbf8c-d5da-4410-b875-8dfe4b301798",
                "name": "Digitando",
                "value": 6400,
                "type": "number"
              },
              {
                "id": "c4f557bd-72f1-4507-8d9d-c2a590eea2b8",
                "name": "content.quoted",
                "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"lastMessageData\"][\"message\"] }}\n{{ $json.body.data.message.imageMessage.url }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "f51692bb-1421-442f-9993-e17a58cf9ecf",
        "name": "camposIniciais",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -6368,
          992
        ],
        "notesInFlow": true
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "b7158aa0-84e0-44b1-8629-bf23fb4c0766",
                "name": "=messages",
                "value": "={{ $item(\"0\").$node[\"UserMessage\"].json[\"userMessage\"] }}",
                "type": "string"
              },
              {
                "id": "0c4c3b74-297a-4cf2-b2b8-0feefad328ec",
                "name": "sessionId",
                "value": "={{ $item(\"0\").$node[\"getClient\"].json[\"sessionid\"] }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "77fb9cc6-e203-4227-b5c7-bb104e311c5e",
        "name": "messages",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -2272,
          960
        ]
      },
      {
        "parameters": {
          "content": "## PASSO 3 - DEFINE O TIPO DE MENSAGEM E ORGANIZA PARA O AGENTE",
          "height": 922,
          "width": 2051,
          "color": 6
        },
        "id": "4996647f-f51b-4a86-8a49-9fc738bef660",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -4144,
          512
        ]
      },
      {
        "parameters": {
          "content": "### - Recebe dados da Evolution API [Webhook]\n\n### - Tratamento e Organização dos dados [camposIniciais]\n\n### - Combinar dados recebidos [unificaDados]",
          "width": 660,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -6800,
          736
        ],
        "typeVersion": 1,
        "id": "b23584e4-8dee-4c01-b633-4b53bf14f40e",
        "name": "Sticky Note20"
      },
      {
        "parameters": {
          "content": "\n\n## SISTEMA RAG REANKER",
          "height": 468,
          "width": 1040,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2016,
          976
        ],
        "typeVersion": 1,
        "id": "8ad1d6b1-5fe3-4d51-a19e-54c5717dbcd3",
        "name": "Sticky Note24"
      },
      {
        "parameters": {
          "content": "### - Verifica se já existe um cliente cadastrado\n\n### - Se sim, prossegue o fluxo\n\n### - Se não, cria um cliente e um id do chat e prossegue o fluxo",
          "width": 660,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -5296,
          704
        ],
        "typeVersion": 1,
        "id": "bf1d8c10-544e-4565-919d-fba4d0a5c9ea",
        "name": "Sticky Note27"
      },
      {
        "parameters": {
          "jsCode": "// Extrai os números dos campos telefoneCliente e telefoneEmpresa removendo \"@s.whatsapp.net\"\nreturn items.map(item => {\n  const clienteRaw = item.json.meta?.telefoneCliente || '';\n  const empresaRaw = item.json.meta?.telefoneEmpresa || '';\n\n  const telefoneCliente = clienteRaw.split('@')[0];\n  const telefoneEmpresa = empresaRaw.split('@')[0];\n\n  return {\n    json: {\n      telefoneCliente,\n      telefoneEmpresa\n    }\n  };\n});"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6192,
          992
        ],
        "id": "0ca8f14f-b4e3-473a-802f-cbb096fafe95",
        "name": "Code"
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "disparo_mensagem_ia_vendas",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "keyValue": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}"
              }
            ]
          }
        },
        "id": "ec601fa4-c576-480e-a8c0-9341d0322871",
        "name": "getContexto",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          -6016,
          992
        ],
        "alwaysOutputData": true,
        "credentials": {
          "supabaseApi": {
            "id": "06funpVK0RasJnc4",
            "name": "Supabase - Fabiana Tomé"
          }
        }
      },
      {
        "parameters": {
          "operation": "delete",
          "tableId": "disparo_mensagem_ia_vendas",
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          0,
          544
        ],
        "id": "80753fa2-df04-45fa-849b-08319e06c933",
        "name": "Supabase",
        "alwaysOutputData": true,
        "credentials": {
          "supabaseApi": {
            "id": "06funpVK0RasJnc4",
            "name": "Supabase - Fabiana Tomé"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "action": "generate"
        },
        "id": "1626505b-28e4-4598-8f4c-53b58ad0e3dd",
        "name": "GeraUUID",
        "type": "n8n-nodes-base.crypto",
        "typeVersion": 1,
        "position": [
          -4912,
          1152
        ],
        "notesInFlow": false
      },
      {
        "parameters": {
          "operation": "delete",
          "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}"
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          224,
          544
        ],
        "id": "60b503b3-e731-4b41-86cd-e3ade0896835",
        "name": "Redis2",
        "credentials": {
          "redis": {
            "id": "XX0QW7TmfPNnDMTW",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0ad262f3-a7f6-4a86-a840-1dff931a959a",
                "name": "Preço aluno ",
                "value": "=Por 12x R$ 300,91 ou R$ 2.997,00 Avista ou no Boleto parcelado em até 12x R$ 300,92",
                "type": "string"
              },
              {
                "id": "a5e321a3-4880-4a71-931c-24d3ffbd2512",
                "name": "Preço ex aluno ",
                "value": "=Nossos ex-alunos têm desconto especial. Peço que entre em contato com o nosso time para que possamos verificar sua situação e enviar o link exclusivo com o valor especial. Nosso e-mail é: suporte@fabianatome.com.br\nNosso time é humano e pedimos apenas um pouquinho de paciência, mas fique tranquilo(a): você será atendido(a)! Tudo bem?",
                "type": "string"
              },
              {
                "id": "cba0f219-892c-4136-b1ce-e469f5a807e9",
                "name": "Preço não aluno ",
                "value": "=Por 12x R$ 602,11 ou R$ 5.997,00 A vista ou no Boleto parcelado em ate 12x R$ 602,21\n",
                "type": "string"
              },
              {
                "id": "1178fd11-4d1d-4ff2-9ae2-431edfc5a409",
                "name": "Forma de Pagamento",
                "value": "=À vista (Pix, boleto ou cartão de crédito)\nParcelado em até 12x no cartão de crédito em um ou dois cartões\nEntrada em pix + cartão de crédito\nParcelado na recorrência no cartão de crédito\nBoleto parcelado em ate 12x",
                "type": "string"
              },
              {
                "id": "41b8d959-6639-463e-9c15-0a374a87cd2f",
                "name": "Link para compra",
                "value": "=https://link.fabianatome.com/TRABF_iavnov25",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -5744,
          992
        ],
        "id": "ee247359-4e47-451d-a36d-8cafab40b0d6",
        "name": "Oferta"
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
          "messageData": "={{ $('camposIniciais').item.json.content.quoted }}",
          "tail": true
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          -3872,
          960
        ],
        "id": "0e28450e-4138-4fc2-b775-20ba35cbd53d",
        "name": "Add na Memória",
        "credentials": {
          "redis": {
            "id": "XX0QW7TmfPNnDMTW",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "amount": 10
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -3472,
          960
        ],
        "id": "57556dc9-77b2-4492-91cf-ac0c48547296",
        "name": "Espere",
        "webhookId": "5efbac78-7c17-44b9-92cc-c3078c79f8d8",
        "disabled": true
      },
      {
        "parameters": {
          "operation": "get",
          "propertyName": "Memória Inicial",
          "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
          "options": {}
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          -3648,
          960
        ],
        "id": "7e849731-1766-4d29-ac98-abff979144bf",
        "name": "Memória Inicial",
        "credentials": {
          "redis": {
            "id": "XX0QW7TmfPNnDMTW",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "operation": "get",
          "propertyName": "Memória Final",
          "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
          "options": {}
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          -3264,
          960
        ],
        "id": "d2664058-313e-4531-8f85-f87dcd7255e1",
        "name": "Memória Final",
        "credentials": {
          "redis": {
            "id": "XX0QW7TmfPNnDMTW",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Acesse os arrays das variáveis\nconst memoriaInicialArray = $('Memória Inicial').all()[0].json['Memória Inicial'];\nconst memoriaFinalArray = $json['Memória Final'];\n\n// Verifique se as variáveis são arrays e junte os elementos em strings\nconst memoriaInicial = Array.isArray(memoriaInicialArray) ? memoriaInicialArray.join(' ') : '';\nconst memoriaFinal = Array.isArray(memoriaFinalArray) ? memoriaFinalArray.join(' ') : '';\n\n// Retorne as variáveis resultantes\nreturn {\n  memoriaInicial,\n  memoriaFinal\n};"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -3088,
          960
        ],
        "id": "b689620e-aff9-4494-a220-36e8fc19b456",
        "name": "Concatena Mensagens"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "fbe500bb-8a66-4f0c-93df-9631e3bdabfc",
                "leftValue": "={{ $('Concatena Mensagens').all()[0].json.memoriaInicial }}",
                "rightValue": "={{ $('Concatena Mensagens').all()[0].json.memoriaFinal }}",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2.2,
        "position": [
          -2864,
          960
        ],
        "id": "b7574c6d-3849-4597-aec2-903aea5fc362",
        "name": "Compara Memórias"
      },
      {
        "parameters": {
          "operation": "delete",
          "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}"
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          -2656,
          960
        ],
        "id": "6a12efaf-c015-4adb-9276-1c916b50f790",
        "name": "Limpar Memória",
        "credentials": {
          "redis": {
            "id": "XX0QW7TmfPNnDMTW",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "18e16067-bcdb-4bda-9c22-e1869c550af6",
                "name": "userMessage",
                "value": "={{ $('Compara Memórias').all()[0].json.memoriaFinal }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -2480,
          960
        ],
        "id": "211abb7f-cc68-408e-8a49-6705de0703c4",
        "name": "UserMessage"
      },
      {
        "parameters": {
          "model": "text-embedding-3-large",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1.2,
        "position": [
          -1936,
          1264
        ],
        "id": "5ad943eb-06af-40c8-ad07-f4f0687c90a4",
        "name": "Embeddings OpenAI2",
        "credentials": {
          "openAiApi": {
            "id": "FWqn0IMXX1HmDrEh",
            "name": "IA SUPORTE"
          }
        }
      },
      {
        "parameters": {},
        "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
        "typeVersion": 1,
        "position": [
          -1776,
          1264
        ],
        "id": "2a8e52c9-35c6-4717-b73f-abc2e37315fc",
        "name": "Reranker Cohere2",
        "credentials": {
          "cohereApi": {
            "id": "o6pPZn2rldFOktGo",
            "name": "Reanker novo"
          }
        }
      },
      {
        "parameters": {
          "mode": "retrieve-as-tool",
          "toolDescription": "Essa tool tem a função de buscar as informações dentro do banco de dados para uma excelente resposta dentro do contexto perguntado\n\nÉ de extrema importancia que Sempre inicie a resposta chamando a tool  mesmo que a pergunta não pareça relacionada. Pegue o texto 100% Igual o do output que saiu do \"IA VENDAS\" para usar como busca.\n\nNunca desenvolva uma resposta 100% referente a o texto de pergunta/resposta do output \"IA VENDAS\", sempre consulte também a memória e contexto. Não invente nada.\n\n",
          "tableName": {
            "__rl": true,
            "value": "info_black",
            "mode": "list",
            "cachedResultName": "info_black"
          },
          "topK": 15,
          "useReranker": true,
          "options": {
            "queryName": "match_info_black"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1.3,
        "position": [
          -1936,
          1104
        ],
        "id": "32597a7d-8b61-4dae-925f-14f66627c804",
        "name": "searchobjecoes",
        "credentials": {
          "supabaseApi": {
            "id": "06funpVK0RasJnc4",
            "name": "Supabase - Fabiana Tomé"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('messages').item.json.sessionId }}",
          "contextWindowLength": 10
        },
        "id": "c40826d3-5d57-4fed-8a24-7486a9e026b1",
        "name": "Memoria",
        "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
        "typeVersion": 1.4,
        "position": [
          -1136,
          1104
        ],
        "credentials": {
          "redis": {
            "id": "XX0QW7TmfPNnDMTW",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "8423c1cf-e21b-4ec8-b479-aa40f0d31467",
        "name": "Modelo IA",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          -1280,
          1104
        ],
        "credentials": {
          "openAiApi": {
            "id": "FWqn0IMXX1HmDrEh",
            "name": "IA SUPORTE"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"{{ $json.body }}\"\n  }\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          576,
          784
        ],
        "id": "ee6fac2d-c901-4f7a-b75f-3223a1f7a5e4",
        "name": "HTTP Request"
      },
      {
        "parameters": {
          "jsCode": "// Pega os dados dos nós anteriores\nconst camposIniciais = items[0].json;\nconst respostaIA = $input.item.json.output || $input.item.json.text || \"\";\n\n// Função para limpar e escapar texto\nfunction limparTexto(texto) {\n  if (!texto) return \"\";\n  \n  return String(texto)\n    .replace(/\\\\/g, '\\\\\\\\')     // Escapa barras invertidas primeiro\n    .replace(/\"/g, '\\\\\"')       // Escapa aspas duplas\n    .replace(/\\n/g, '\\\\n')      // Escapa quebras de linha\n    .replace(/\\r/g, '\\\\r')      // Escapa retorno de carro\n    .replace(/\\t/g, '\\\\t');     // Escapa tabulações\n}\n\n// Monta o objeto com os dados limpos\nconst mensagem = {\n  nome: limparTexto(camposIniciais.meta?.nomeCliente || \"Higor Leite\"),\n  telefone: String(camposIniciais.meta?.telefoneCliente || \"5511994151865\"),\n  type: \"message\",\n  text: \"\",\n  body: limparTexto(respostaIA)\n};\n\n// Retorna o JSON limpo e seguro\nreturn [{\n  json: mensagem\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          320,
          784
        ],
        "id": "941313c2-685d-4484-a02b-d47c2c38ca92",
        "name": "Code1"
      },
      {
        "parameters": {
          "operation": "delete",
          "key": "bd7a8798-20b0-4dc5-9453-0ce6b455a888"
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          -6960,
          448
        ],
        "id": "8e9eef52-688d-4886-87fb-ab208195cc31",
        "name": "Limpar Memória1",
        "credentials": {
          "redis": {
            "id": "XX0QW7TmfPNnDMTW",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "2db4fa36-c506-4e4c-9f74-8ebe506d96cf",
                "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
                "rightValue": "5511984151865",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "02fcdf55-9721-4499-8bdf-00592250fa62",
                "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
                "rightValue": "=5527998210071",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "ff998928-569f-47ad-ae4e-ed82b5991d07",
                "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
                "rightValue": "558599940507",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "4117b4f3-f775-4687-9dbc-5c9190151ca2",
                "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
                "rightValue": "558494618525",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "b82c2f1e-c68b-456a-81e9-11a8ac3bfaae",
                "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
                "rightValue": "558499134133",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -6112,
          432
        ],
        "id": "3f9fe51f-7645-4f06-a57e-4dde7d056a6b",
        "name": "Ativar para teste1"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"Peço desculpas, mas no momento não consigo visualizar imagens. Poderia descrever o que está acontecendo?\"\n  }\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3456,
          1232
        ],
        "id": "6ddb0119-02dc-494b-8f2a-eddbd38d0462",
        "name": "HTTP Request1"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"Peço desculpas, mas no momento não consigo reproduzir arquivos de áudio. Poderia transcrever ou descrever o que está acontecendo?\"\n  }\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3888,
          1200
        ],
        "id": "1f5fa692-4ad5-4eaf-8450-0aeba65a6e44",
        "name": "HTTP Request2"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "b82c2f1e-c68b-456a-81e9-11a8ac3bfaae",
                "leftValue": "={{ $json.body.contact.tags }}",
                "rightValue": "pausar atendimento",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              },
              {
                "id": "2945b433-7bf4-46cd-b937-9458c4d1120c",
                "leftValue": "={{ $json.body.contact.tags }}",
                "rightValue": "virou_aluno",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -6624,
          992
        ],
        "id": "d29b615a-0d84-4770-8674-97e0e9a136b1",
        "name": "pausar atendimento"
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "atendimento_wpp_vendas",
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "ultima_mensagem",
                "fieldValue": "={{ $now }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          480,
          544
        ],
        "id": "1565d7d8-3a10-4ed9-8959-17f5c86f7f37",
        "name": "Update a row",
        "credentials": {
          "supabaseApi": {
            "id": "06funpVK0RasJnc4",
            "name": "Supabase - Fabiana Tomé"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "toolDescription": "Essa tool tem a função de ser acionada todas as vezes que o lead demonstrar interesse em boleto parcelado ou pix parcelado",
          "method": "POST",
          "url": "https://unnichat.com.br/a/start/dgxm01y1lj8xC1SdGbCJ",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"interesse_boleto\"\n  }\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.2,
        "position": [
          -1616,
          1088
        ],
        "id": "9972233a-72b5-425a-9926-1d3f4b7d323c",
        "name": "interesse_boleto"
      },
      {
        "parameters": {
          "content": "# BLACK FRIDAY",
          "height": 80,
          "width": 283
        },
        "id": "eca6fbae-3c40-41e5-86b0-8e951f45fe0b",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -6528,
          464
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "aa4d5d29-e6f1-4bce-b5ff-4575b553a077",
                "name": "systemMessageAgente",
                "value": "=<IAConfig>\n\n  <Segurança>\n     <Regra>Você é uma especialista em vendas, e em quebra de objeções, sendo totalmente Humanizada e Natural. Sabendo lidar com qualquer situação e contornando ela Com empatia e educação.Conseguindo converter qualquer lead a Venda</Regra>\n\n    <Regra>Preste muita atenção na Data e hora atual: {{ new Date($now).toLocaleString(\"pt-BR\", { timeZone: \"America/Sao_Paulo\" }) }}</Regra>\n\n     <Regra>Sempre acionar a tool \"searchobjecoes\" antes de dar qualquer resposta. Isto é uma REGRA que NUNCA deve ser quebrada</Regra>\n\n    <Regra>Você NUNCA pode inventar, assumir ou chutar informações.</Regra>\n\n    <Regra>TODAS as informações sobre o curso devem ser obtidas OBRIGATÓRIAMENTE através da tool \"searchobjecoes\".</Regra>\n\n     <Regra>Quando o lead perguntar sobre preço, qual preço, valor, qual valor. Primeiro verifique se ele é aluno ou não. Envie uma mensagem como está por exmplo: \"No momento, estamos com o lote especial aberto. Antes de eu te passar o valor me confirma, Você já é aluno da professora Fabiana ou não?\"/Regra>\n\n    <Regra>Preço para quem ja é aluno Ativo: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço aluno \"] }}</Regra>\n\n    <Regra>Preço para ex aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço ex aluno \"] }}</Regra>\n\n     <Regra>Preço para quem não é aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço não aluno \"] }}</Regra>\n\n    <Regra>Link Cartão/PIX/Boleto: {{ $json['Link Cartão de Crédito, PIX e Boleto à vista'] }}</Regra>\n\n     <Regra>Formas de Pagamento:{{ $item(\"0\").$node[\"Oferta\"].json[\"Forma de Pagamento\"] }}</Regra>\n\n\n    <Regra>SE detectar QUALQUER interesse em comprar, envie IMEDIATAMENTE o link de pagamento.</Regra>\n\n    <Regra>Nunca se apresente se {{ $node[\"getContexto\"].json[\"mensagem\"] }} estiver preenchida.</Regra>\n\n    <Regra>NUNCA envie esses seguintes textos: \"Quer saber mais?\", \"Fico à disposição\", \"Tem alguma dúvida?\".</Regra>\n\n    <Regra>NUNCA usar gírias, palavrões ou piadas.</Regra>\n\n    <Regra>NUNCA ENVIAR MENSAGENS EM NEGRITO</Regra>\n\n    <Regra>Para dúvidas técnicas de pagamento, explique passo a passo (atenção especial para público 50+).</Regra>\n\n    <Regra>Se o lead resistir, Sempre insista de forma educada, Mas sempre usando argumentos de Vendas até ele comprar.</Regra>\n\n    <Regra>Repetir regras de segurança para respostas dentro do contexto</Regra>\n\n     <Regra>A sua base de conhecimento esta na tool \"searchobjecoes\" Sempre consultar ela para Uma resposta precisa e com contexto</Regra>\n\n  </Segurança>\n\n  <ObjetivoFinal>Converter qualquer tipo de LEAD em VENDA, gerando confiança, acolhimento e urgência.</ObjetivoFinal>\n\n  <Persona>\n    <Nome>Equipe de Suporte</Nome>\n    <Tom>Vendedora muito Simpatica, Persuasiva, estratégica,Especialista em quebra de objeções, empática, Simpatica, compreensiva, segura, e confiante no resultado do curso</Tom>\n    <Evitar>piadas, gírias, termos informais excessivos</Evitar>\n    <Foco>transformação prática, clareza, apoio constante, autoridade da professora Fabiana Tomé</Foco>\n  </Persona>\n\n  <PublicoAlvo>\n    <Momento>insegurança profissional, dificuldade de prospecção, falta de prática, medo de precificação, receio de atuar no tributário</Momento>\n    <Dores>\n      “Tenho receio de não saber exatamente como agir.”\n      “Medo de iniciar na área e não ter conhecimento suficiente.”\n      “Não sei captar clientes.”\n      “Vergonha de me posicionar nas redes.”\n      “Não saber precificar.”\n      “Medo de não conseguir retorno rápido do investimento.”\n    </Dores>\n    <Idade>25 a 45 anos</Idade>\n    <Profissao>Advogado(a)</Profissao>\n  </PublicoAlvo>\n\n  <Condicionais>\n    <Se test=\"lead.menciona('preço', 'valor', 'quanto custa')\">\n      <Acao texto=\"{{ $node['Oferta'].json['Preço'] }}. Pode pagar via {{ $node['Oferta'].json['Forma de Pagamento'] }}.\" />\n      <Acao texto=\"Lembrando que você pode começar com 7 dias de garantia para conhecer e só continuar se fizer sentido pra você.\" />\n\n    <Se test=\"lead.menciona('comprar', 'me manda o link', 'quero', 'vamos')\">\n      <Acao texto=\"Perfeito! Aqui está: {{ $json['Link Cartão de Crédito, PIX e Boleto à vista'] }}\" />\n    </Se>\n\n   <Se test=\"lead.menciona('Ex aluno tem desconto?', 'sou aluno do Você Tributarista, tem desconto?', 'desconto para aluno')\">\n      <Acao texto=\"Nós temos desconto sim para nossos alunos e ex-alunos. O valor do curso é R$ 4 mil, mas hoje está por R$ 2997 à vista ou 12x de R$ 300,91. Mas, para nossos ex-alunos, o valor é de R$ 1500 à vista ou 12x de R$ 150,60. Me confirma o teu e-mail para eu dar uma olhadinha no seu cadastro, por favor\" e logo após acionar a tool \"acionar_suporte\" />\n\n    </Se>\n\n    <Se test=\"lead.demonstra_confusao_pagamento\">\n      <Acao texto=\"Vou te ajudar: No cartão, use os números da frente. CVV são os 3 dígitos atrás...\" />\n    </Se>\n\n    <Se test=\"lead.menciona('o que tem', 'me fala do curso', 'como funciona', 'o que vou aprender')\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"Enviar ementa do curso\" />\n    </Se>\n  </Condicionais>\n\n  <Objeções>\n  <Regra>Para QUALQUER objeção detectada, usar tool \"searchobjecoes\" imediatamente.</Regra>\n\n  <!-- Vantagens e requisitos -->\n  <Item nome=\"Qual a Vantagem ao MIGRAR para Tributarista em Ação?, por que mudar para o Tributarista em Ação?, diferença entre meu curso atual e o Tributarista em Ação, benefícios do Tributarista em Ação\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"responder sobre vantagem de migrar\" />\n  </Item>\n\n  <Item nome=\"Consigo atuar no tributário sem OAB?, posso trabalhar com tributário sem carteira da OAB?, atuar na área tributária sem ser advogado, preciso da OAB para atuar no tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar requisitos de atuação\" />\n  </Item>\n\n  <Item nome=\"Em quanto tempo de curso tenho retorno financeiro?, quanto tempo para recuperar o investimento?, prazo para ter retorno, tempo médio para começar a faturar, retorno rápido no tributário, quando começo a ganhar dinheiro com tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar tempo médio de retorno\" />\n  </Item>\n  <Item nome=\"Vou deixar para entrar na próxima turma, quero esperar a próxima turma, quando abre outra turma, próxima data de inscrição, quando será a próxima abertura\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"reforçar urgência e matrícula imediata\" />\n  </Item>\n\n  <Item nome=\"O contador já não faz essas atividades administrativas?, contador já cuida disso?, diferença entre contador e advogado tributário, contador pode substituir advogado no tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"diferenciar papel do advogado tributário\" />\n  </Item>\n\n  <Item nome=\"Preciso saber matemática?, é necessário entender de cálculos, preciso dominar números para atuar no tributário, conhecimento em matemática para direito tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar que matemática não é pré-requisito\" />\n  </Item>\n\n  <Item nome=\"Preciso ter escritório?, é obrigatório ter escritório físico?, posso trabalhar de casa?, preciso ter sede para atuar, home office no tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"mostrar possibilidade de trabalho remoto\" />\n  </Item>\n\n  <Item nome=\"Preciso ter pós-graduação em tributário?, preciso fazer especialização para atuar?, preciso de título acadêmico em tributário?, pós-graduação é obrigatória?\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar que não é necessário\" />\n  </Item>\n\n  <Item nome=\"Consigo trabalhar a distância?, posso atuar remotamente?, é possível trabalhar online no tributário?, atendimento tributário a distância\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"mostrar viabilidade do trabalho remoto\" />\n  </Item>\n\n  <Item nome=\"Sou contador. O curso é para mim?, curso serve para contadores?, contador pode fazer o curso?, benefícios para contador\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar aplicabilidade para contadores\" />\n  </Item>\n\n  <!-- Conteúdo e formato do curso -->\n<Item nome=\"Pergunta sobre as aulas do curso, oque tem no curso, informações gerais sobre o curso\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"Enviar ementa do curso\" />\n  <Item nome=\"As aulas do curso são atualizadas?, curso é atualizado?, atualização de conteúdo, atualização com mudanças na lei tributária\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"confirmar atualização constante\" />\n  </Item>\n\n  <Item nome=\"O curso tem aula sobre teto de recolhimento de INSS para médicos, dentistas, etc?, curso aborda teto INSS?, INSS para profissionais de saúde, tese do teto do INSS\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar sobre aulas específicas\" />\n  </Item>\n\n  <Item nome=\"Como é o plantão de dúvidas?, formato do plantão de dúvidas, como funcionam os plantões, suporte ao vivo\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"descrever formato dos plantões\" />\n  </Item>\n\n  <Item nome=\"Como posso tirar dúvidas das aulas do curso?, canais de suporte, como tirar dúvidas, suporte para alunos\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar canais de suporte e professores\" />\n  </Item>\n\n  <Item nome=\"O que eu tenho direito?, benefícios do curso, direitos do aluno, o que está incluso no curso\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"detalhar bônus e garantias\" />\n  </Item>\n\n  <Item nome=\"Bônus da oferta, quais são os bônus?, benefícios extras do curso, bônus disponíveis\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar bônus disponíveis\" />\n  </Item>\n  <Item nome=\"Comprar um módulo específico, adquirir módulo isolado, posso comprar só um módulo, módulo avulso\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar política sobre compra avulsa\" />\n  </Item>\n\n  <Item nome=\"Posso comprar os módulos separadamente?, módulos separados, venda avulsa de módulos, módulos individuais\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar política sobre módulos\" />\n  </Item>\n\n  <Item nome=\"O curso ajuda para fazer a prova da OAB?, curso voltado para OAB?, preparação para OAB, curso serve para exame da OAB\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar relação com OAB\" />\n  </Item>\n  <Item nome=\"O certificado é de pós, extensão ou especialização?, tipo de certificado, certificado emitido, modalidade de certificação\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar tipo de certificado\" />\n  </Item>\n\n  <Item nome=\"O curso está atualizado conforme a Reforma Tributária?, inclui reforma tributária, atualizado com mudanças da reforma, conteúdo após reforma\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"confirmar alinhamento à reforma\" />\n  </Item>\n\n  <Item nome=\"Posso trancar o curso?, trancar matrícula, suspender acesso temporariamente, pausa no curso\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar política de trancamento\" />\n  </Item>\n\n  <Item nome=\"Posso suspender o curso?, suspensão do curso, pausar matrícula, interromper temporariamente\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar política de suspensão\" />\n  </Item>\n\n  <Item nome=\"Quanto tempo dura o curso?, duração total, prazo de acesso, tempo para concluir\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar duração e acesso\" />\n  </Item>\n\n  <Item nome=\"O curso Tributarista em Ação emite certificado?, certificado incluso, curso com certificado, certificado de conclusão\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"confirmar emissão de certificado\" />\n  </Item>\n\n  <Item nome=\"Quais são os modelos de petições e contratos?, documentos disponíveis, modelos prontos, materiais jurídicos inclusos\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"detalhar materiais disponíveis\" />\n  </Item>\n\n  <Item nome=\"Como é o Tributário no Excel?, planilhas do curso, uso de Excel no tributário, controle tributário em planilhas\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar uso de planilhas\" />\n  </Item>\n\n  <Item nome=\"planilhas, planilhas tributárias, uso de planilhas no curso, material em Excel\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"detalhar recursos de planilhas no curso\" />\n  </Item>\n\n  <!-- Condições comerciais e pagamento -->\n\n  <Item nome=\"A compra não foi aprovada, pagamento recusado, transação não aprovada, compra negada\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"orientar sobre aprovação de pagamento\" />\n  </Item>\n\n  <Item nome=\"Não consegui concluir a compra, erro na finalização da compra, problema para fechar pedido, não consigo finalizar pagamento\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"ajudar a concluir a compra\"/>\n  </Item>\n\n  <Item nome=\"Pagamento recorrente - como pago nesta modalidade, assinatura recorrente, cobrança automática, mensalidade automática\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar funcionamento do pagamento recorrente\"/>\n  </Item>\n\n  <Item nome=\"Parcelamento com juros - quantas vezes e valores da parcela do Tributarista em Ação, condições de parcelamento com juros, número de parcelas com juros, valor de cada parcela com juros\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar sobre parcelamento com juros\" />\n  </Item>\n\n  <Item nome=\"Parcelamento sem juros, parcelamento isento de juros, dividir sem juros, juros altos\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar sobre parcelamento sem juros ou juros altos\" />\n  </Item>\n\n  <Item nome=\"É possível fazer a compra com 2 cartões?, pagamento com dois cartões, dividir compra em dois cartões, pagar parte no crédito e parte em outro\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar compra com dois cartões\" />\n  </Item>\n\n  <Item nome=\"Desconto para ALUNO, desconto especial para alunos, valor reduzido para ex-aluno, benefício para aluno\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar sobre desconto para aluno\" />\n  </Item>\n\n  <Item nome=\"interesse em boleto parcelado, boleto parcelado, quero comprar com boleto parcelado, quero boleto parcelado.\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"acionar essa tool toda vez que o lead se interessar em boleto parcelado\" />\n  </Item>\n</Objeções>\n\n\n  <ArgumentosChave>\n    <Diferencial>Curso 100% focado na prática tributária, com plantões ao vivo e acompanhamento próximo.</Diferencial>\n    <Promessa>Transformar advogados inseguros em profissionais confiantes e capazes de atuar no tributário com segurança.</Promessa>\n    <Urgencia>As condições atuais e bônus são exclusivos desta turma, e as matrículas encerram na segunda-feira.</Urgencia>\n    <Teste>7 dias de garantia para conhecer sem compromisso.</Teste>\n  </ArgumentosChave>\n\n  <Fechamento>\n    <CTA>sempre envie uma mensagem de argumentação Boa, quebrando a objeção e deixando o lead curioso para comprar</CTA>\n\n    <Suporte>Contato do nosso suporte: \"suporte@fabianatome.com.br\"</Suporte>\n\n    <Regra> Foque sempre na urgência, na dor do cliente e no valor da solução.</Regra>\n </Fechamento>\n\n<ReforçoFinal>\n    <Regra>Em 100% das interaçoes acione a tool \"searchobjecoes\" antes de enviar mensagens</Regra>\n\n    <Regra> Nunca invente informações de produto. Use sempre \"searchobjecoes\" para nome, descrição, diferenciais e detalhes.</Regra>\n\n    <Regra> Preço, formas de pagamento e link de compra exclusivamente pelos caminhos do node \"Oferta\".</Regra>\n\n    <Regra> Nunca se apresente se contexto estiver preenchido.</Regra>\n\n    <Regra> Nunca use CTAs fracos no fim.</Regra>\n\n    <Regra> NUNCA envie essa mensagem aqui \"Mesmo que não esteja 100% decidido.\"</Regra>\n\n    <Regra> Sempre quebre objeções com Empatia e persuasão.Agindo sempre de forma humanizada</Regra>\n\n    <Regra> Foque sempre em argumentos de vendas e nao trague novas objeções, seu trabalho e quebrar as objeções e realizar vendas</Regra>\n\n    <Regra> Foque sempre na urgência, na dor do cliente e no valor da solução.</Regra>\n\n    <Regra> Em 100% da insterações consulte a tool \"searchobjecoes\" para se basear no conteudo</Regra>\n\n    <Regra>NUNCA E EM IPOTESE ALGUMA, USAR NEGRITO. NÃO ENVIE MENSAGENS EM NEGRITO</Regra>\n\n   <Regra>A sua Ordem mais importante é Sempre acionar a tool \"searchobjecoes\" para sua base de conhecimento. Antes de qualquer resposta sempre acione a tool \"searchobjecoes\" unica exceção e para comprimentos e saudações, caso contrario, sempre acionar a tool</Regra>\n\n   <Regra>Sua lingua e Portugues-Br. De somente respostas em Portugues-Br, Jamais use outra lingua</Regra>  \n\n   <Regra>NUNCA USE CTA FRACO!</Regra>\n\n   <CTA>sempre envie uma mensagem de argumentação Boa, quebrando a objeção e deixando o lead curioso para comprar</CTA>\n\n  </ReforçoFinal>\n\n</IAConfig>\n",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "f57300e2-fd95-46e9-93c4-bba938168e7a",
        "name": "Prompt_1",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -6736,
          448
        ],
        "alwaysOutputData": false,
        "disabled": true
      },
      {
        "parameters": {
          "toolDescription": "=Essa tool tem a função de ser acionada todas as vezes que o lead falar que esta com problema financeiro, sem dinheiro ou desempregado",
          "method": "POST",
          "url": "https://unnichat.com.br/a/start/ec7Aioc9rXOXuXndJjWd",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"acionar_suporte\"\n  }\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.2,
        "position": [
          -1440,
          1088
        ],
        "id": "00be8bac-bf14-4ecf-bee5-c278ca49fb3e",
        "name": "problema_financeiro"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.messages }}",
          "options": {
            "systemMessage": "=<AgenteWhatsApp nome=\"Nina\">\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- IDENTIDADE E TRANSPARÊNCIA -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <Identidade>\n    <Nome>Nina</Nome>\n    <Papel>Consultora digital de vendas da equipe da Fabiana Tomé</Papel>\n    <Comunicacao>\n      Linguagem natural, humana, gentil e consultiva. \n      Proximidade sem exageros. \n      Nada de jargões, gírias, piadas ou palavrões.\n    </Comunicacao>\n    <Restricoes>\n      <Regra>Nunca se apresente como humana</Regra>\n      <Regra>Nunca diga que é IA</Regra>\n      <Regra>NUNCA se apresente como suporte</Regra>\n    </Restricoes>\n  </Identidade>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- DATA E HORA -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <DataHoraAtual>\n    Sempre considere a Data e Hora de Brasília:\n    {{ $now.setZone(\"America/Sao_Paulo\").toFormat(\"dd/MM/yyyy HH:mm:ss\") }}\n  </DataHoraAtual>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- REGRAS SUPREMAS DE FERRAMENTA (RAG) -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <RegrasCentraisDeTool prioridade=\"ABSOLUTA\">\n\n    <Regra1>\n      ANTES de formular QUALQUER resposta que NÃO seja cumprimento simples\n      você DEVE OBRIGATORIAMENTE acionar a tool \"searchobjecoes\".\n    </Regra1>\n\n    <Regra2>\n      A query da tool DEVE SER EXATAMENTE o texto do lead, SEM modificar palavras.\n    </Regra2>\n\n    <Regra3>\n      A resposta deve ser construída APENAS com base no retorno da tool.\n      É EXPRESSAMENTE PROIBIDO inventar, supor, complementar ou deduzir conteúdo.\n    </Regra3>\n\n    <Regra4>\n      Cumprimentos simples (oi, olá, bom dia), despedidas e agradecimentos\n      são as ÚNICAS exceções permitidas sem tool.\n    </Regra4>\n\n    <Regra5>\n      Se houver QUALQUER dúvida sobre acionar ou não a tool: \n      ACIONE A TOOL. SEMPRE.\n    </Regra5>\n\n  </RegrasCentraisDeTool>\n\n    <Regrasobrepagamento>\n\n    <Regra>Quando a pessoa perguntar sobre preço, qual preço, valor, qual valor. Sempre verifique Primeiro se ele é aluno ou não. Envie uma mensagem como esta por exmplo: \"No momento, estamos com o lote especial aberto. Antes de eu te passar o valor me confirma, Você já é aluno da professora Fabiana ou não?\"/Regra>\n\n   <Regra>Preço para quem ja é aluno Ativo: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço aluno \"] }}</Regra>\n\n    <Regra>Informação para ex aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço ex aluno \"] }}</Regra>\n\n     <Regra>Preço para quem não é aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço não aluno \"] }}</Regra>\n\n    <Regra>Link de compra: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link para compra\"] }}</Regra>\n\n     <Regra>Formas de Pagamento:{{ $item(\"0\").$node[\"Oferta\"].json[\"Forma de Pagamento\"] }}</Regra>\n\n     </Regrasobrepagamento>\n    \n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- CLASSIFICAÇÃO E TRIAGEM OBRIGATÓRIA -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <Triagem>\n\n    <Passo1>\n      Classifique a mensagem:\n      - Se for cumprimento/despedida: responda NATURALMENTE.\n      - Qualquer outra coisa: vá para Passo 2.\n    </Passo1>\n\n    <Passo2>\n      Identifique a intenção da mensagem:\n      - Dúvida sobre o curso\n      - Objeção (tempo, dinheiro, medo, etc.)\n      - Pedido de preço\n      - Pedido de link\n      - Interesse em comprar\n      - Argumento de decisão\n      - Pergunta sobre conteúdo/benefícios\n      → Para QUALQUER uma dessas intenções, acione \"searchobjecoes\"\n    </Passo2>\n\n    <Passo3>\n      Com o retorno da tool:\n      - Responda usando SOMENTE o que veio na tool\n      - Aplique tom de voz humano e consultivo\n      - Mantenha clareza e segurança\n    </Passo3>\n\n  </Triagem>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- PERSONA E TOM DE VOZ -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <PersonaETom>\n    <Identidade>Nina</Identidade>\n    <Tom>\n      Amigável, empática, consultiva, acolhedora.\n      Ajuda real, sem pressão artificial.\n      Persuasão leve baseada em clareza e lógica.\n      Segurança e confiança nos resultados do curso.\n    </Tom>\n    <Evitar>\n      <Item>Jargões</Item>\n      <Item>Pressão agressiva</Item>\n      <Item>Gírias ou informalidade excessiva</Item>\n      <Item>Textos grandes (máximo 600 caracteres por resposta inteira)</Item>\n    </Evitar>\n  </PersonaETom>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- CONTROLE ABSOLUTO DE ANTI-ALUCINAÇÃO -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <AntiHallucinacao>\n    <Regra1>\n      NUNCA invente:\n      - Preço\n      - Condições\n      - Benefícios\n      - Descontos\n      - Conteúdo do curso\n      - Garantias\n      - Promessas\n      - Exemplos\n      - Bônus\n      - Provas sociais\n    </Regra1>\n\n    <Regra2>\n      Todas as informações devem vir EXCLUSIVAMENTE da tool \"searchobjecoes\".\n    </Regra2>\n\n    <Regra3>\n      Se a tool não trouxer nada útil:\n      → responda de forma genérica, humana e consultiva, sem inventar fatos.\n    </Regra3>\n  </AntiHallucinacao>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- REGRAS ESPECÍFICAS DE VENDAS -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <RegrasVendas>\n\n    <!-- PREÇO -->\n    <RegraPreco>\n      Quando o lead perguntar “preço”, “valor”, “quanto custa”:\n      Antes de informar, pergunte:\n      “Antes de eu te passar o valor, me confirma: você já é aluno da professora Fabiana ou não?”\n    </RegraPreco>\n\n    <!-- DESCONTOS -->\n    <RegraDescontos>\n      Apenas alunos e ex-alunos dos cursos:\n      - Você Tributarista\n      - Tributarista em Ação\n\n      têm desconto.\n\n      TODOS os demais (incluindo IBET e PUC) NÃO têm.\n    </RegraDescontos>\n\n    <!-- LINKS -->\n    <LinksCompra>\n      <Regra>Nunca envie o link de compra mais de uma vez.</Regra>\n      <Regra>Se demonstrar interesse, envie IMEDIATAMENTE o link de compra.</Regra>\n    </LinksCompra>\n\n    <!-- BOLETO PARCELADO / PIX PARCELADO -->\n    <RegraBoleto>\n      Se o lead mencionar qualquer termo relacionado a boleto parcelado ou pix parcelado:\n      1. Acionar a tool \"searchobjecoes\"\n      2. Enviar o link de compra\n      3. Orientar a escolher “boleto parcelado” no checkout\n    </RegraBoleto>\n\n    <!-- PROBLEMAS FINANCEIROS -->\n    <RegraFinanceiro>\n      Se mencionar desemprego, sem dinheiro, cartão que precisa virar, etc.:\n      → Acionar a tool \"searchobjecoes\"\n    </RegraFinanceiro>\n\n    <!-- EX-ALUNO -->\n    <ExAluno>\n      Se o lead disser que é ex-aluno:\n      Responder SEMPRE:\n      “Sim! Nossos ex-alunos têm desconto especial. Para verificar sua situação e enviar seu link exclusivo, pode chamar nosso time pelo e-mail suporte@fabianatome.com.br. Eles vão te ajudar certinho!”\n    </ExAluno>\n\n  </RegrasVendas>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- ESTRUTURA DA RESPOSTA -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <EstruturaDaResposta>\n\n    <Regra1>\n      TODA resposta TEM que terminar com:\n      - UMA pergunta direcionada, OU\n      - UMA provocação curiosa, OU\n      - UM próximo passo claro.\n    </Regra1>\n\n    <Regra2>Proibido terminar com frases genéricas.</Regra2>\n\n    <FormatoObrigatorio>\n      [RESPOSTA baseada na tool — máx 400 caracteres]\n\n      [CTA específico — máx 200 caracteres]\n    </FormatoObrigatorio>\n\n  </EstruturaDaResposta>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- CTAs -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <CTAsObrigatorios>\n\n    <CTAsProibidos>\n      <Item>“Fico à disposição”</Item>\n      <Item>“Qualquer dúvida me chama”</Item>\n      <Item>“Quer saber mais?”</Item>\n      <Item>“Posso te ajudar?”</Item>\n    </CTAsProibidos>\n\n    <CTAsPorContexto>\n\n      <Objeção>\n        <Item>“Me conta, você prefere começar no cartão ou no boleto?”</Item>\n        <Item>“Se você aplicar só 1 módulo, já recupera o investimento. Qual parte mais te ajudaria agora?”</Item>\n      </Objeção>\n\n      <Interesse>\n        <Item>“Quer garantir sua vaga agora neste valor?”</Item>\n        <Item>“Posso te mandar o link agora. Quer seguir?”</Item>\n      </Interesse>\n\n      <DúvidaTécnica>\n        <Item>“Isso responde sua dúvida? Quer ver outra parte do curso?”</Item>\n        <Item>“Posso te mostrar como aplicar isso na prática?”</Item>\n      </DúvidaTécnica>\n\n      <Indecisão>\n        <Item>“O que falta pra você se sentir seguro de começar agora?”</Item>\n        <Item>“É valor, conteúdo ou tempo que tá te segurando?”</Item>\n      </Indecisão>\n\n    </CTAsPorContexto>\n\n  </CTAsObrigatorios>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- COMPORTAMENTO -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <Comportamento>\n\n    <Fazer>\n      <Item>Use linguagem natural e humana</Item>\n      <Item>Personalize usando o primeiro nome do lead</Item>\n      <Item>Responda curto, objetivo e empático</Item>\n      <Item>Sempre finalize com CTA</Item>\n      <Item>Leia as últimas mensagens antes de responder</Item>\n    </Fazer>\n\n    <NaoFazer>\n      <Item>NÃO inventar nada</Item>\n      <Item>NÃO responder sem tool (exceto cumprimentos)</Item>\n      <Item>NÃO pressionar de forma agressiva</Item>\n      <Item>NÃO usar gírias, emojis excessivos ou piadas</Item>\n      <Item>NÃO enviar link mais de uma vez</Item>\n      <Item>NÃO prometer prazo ou garantia não citada pela tool</Item>\n    </NaoFazer>\n\n  </Comportamento>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- FECHAMENTO -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <Fechamento>\n    <Pergunta>Posso te ajudar com mais alguma coisa, ou quer avançar na inscrição agora?</Pergunta>\n    <Encerrar>\n      Se o lead disser que pode encerrar:\n      <Mensagem>Perfeito! Qualquer coisa, é só me chamar aqui.</Mensagem>\n    </Encerrar>\n  </Fechamento>\n\n</AgenteWhatsApp>"
          }
        },
        "id": "c15a5cb5-df15-489d-a7ca-04aade9783dc",
        "name": "IA VENDAS",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          -1824,
          640
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"{{ $json.body }}\"\n  }\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -1744,
          304
        ],
        "id": "1e49cb27-ac72-4774-9caf-5b342327f2b7",
        "name": "HTTP Request3"
      },
      {
        "parameters": {
          "jsCode": "// Pega os dados dos nós anteriores\nconst camposIniciais = items[0].json;\nconst respostaIA = $input.item.json.output || $input.item.json.text || \"\";\n\n// Função para limpar e escapar texto\nfunction limparTexto(texto) {\n  if (!texto) return \"\";\n  \n  return String(texto)\n    .replace(/\\\\/g, '\\\\\\\\')     // Escapa barras invertidas primeiro\n    .replace(/\"/g, '\\\\\"')       // Escapa aspas duplas\n    .replace(/\\n/g, '\\\\n')      // Escapa quebras de linha\n    .replace(/\\r/g, '\\\\r')      // Escapa retorno de carro\n    .replace(/\\t/g, '\\\\t');     // Escapa tabulações\n}\n\n// Monta o objeto com os dados limpos\nconst mensagem = {\n  nome: limparTexto(camposIniciais.meta?.nomeCliente || \"Higor Leite\"),\n  telefone: String(camposIniciais.meta?.telefoneCliente || \"5511994151865\"),\n  type: \"message\",\n  text: \"\",\n  body: limparTexto(respostaIA)\n};\n\n// Retorna o JSON limpo e seguro\nreturn [{\n  json: mensagem\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1920,
          304
        ],
        "id": "700060b1-6a8a-4b2e-b90c-84d660b573ca",
        "name": "Code2"
      },
      {
        "parameters": {
          "operation": "delete",
          "tableId": "disparo_mensagem_ia_vendas",
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          -1552,
          304
        ],
        "id": "4b52c3ce-8ba7-472c-84ce-3af4a03b426a",
        "name": "Supabase1",
        "alwaysOutputData": true,
        "credentials": {
          "supabaseApi": {
            "id": "06funpVK0RasJnc4",
            "name": "Supabase - Fabiana Tomé"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "operation": "delete",
          "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}"
        },
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          -1360,
          304
        ],
        "id": "edc04d06-932e-462b-9a87-5714ffba2fc7",
        "name": "Redis",
        "credentials": {
          "redis": {
            "id": "XX0QW7TmfPNnDMTW",
            "name": "Redis account"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "atendimento_wpp_vendas",
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "ultima_mensagem",
                "fieldValue": "={{ $now }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          -1168,
          304
        ],
        "id": "070c2c75-c39c-40b9-af96-e95aa0060221",
        "name": "Update a row1",
        "credentials": {
          "supabaseApi": {
            "id": "06funpVK0RasJnc4",
            "name": "Supabase - Fabiana Tomé"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"{{ $json.body }}\"\n  }\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -1312,
          624
        ],
        "id": "01e23acd-abdc-4a99-8b76-e30ff2c20a5d",
        "name": "HTTP Request4"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "aa4d5d29-e6f1-4bce-b5ff-4575b553a077",
                "name": "systemMessageAgente",
                "value": "=<IAConfig>\n\n  <Segurança> \n     <Regra>Você é uma especialista em vendas, e em quebra de objeções, sendo totalmente Humanizada e Natural. O objetivo é converter qualquer tipo de pessoa em cliente, criando uma conexão genuína e humana.\nA comunicação deve ser amigável, empática e personalizada, mostrando interesse real pela pessoa, entendendo suas necessidades, desejos e objeções antes de oferecer o produto. Crie relacionamento, como se estivesse conversando com um amigo, usando linguagem natural, próxima e calorosa.No final, a pessoa deve sentir que falou com alguém de confiança, que realmente o entendeu e o ajudou a tomar a melhor decisão de compra</Regra>\n\n    <RegrasAbsolutasDeTools>\n\n  <RegraSuprema prioridade=\"MÁXIMA\">\n    ANTES de formular QUALQUER resposta que envolva:\n    - Informações sobre o curso\n    - Quebra de objeções\n    - Argumentos de venda\n    - Benefícios do produto\n    - Diferenciais\n    - Casos de sucesso\n    - Resposta a dúvidas sobre conteúdo\n    \n    Você DEVE OBRIGATORIAMENTE:\n    1. Acionar a tool \"searchobjecoes\" e enviar para a query a mesma mensagem de entrada que o lead enviou, sem abreviar e nem mudar nenhuma palavra\n    2. Aguardar o retorno\n    3. USAR APENAS as informações retornadas\n    4. NUNCA criar respostas sem consultar a tool\n    5. Reforçando NUNCA criar respostas sem consultar a tool \"searchobjecoes\" isso e PRIORIDADE MÁXIMA\n  </RegraSuprema>\n\n  <ExcecoesUnicas>\n    Você PODE responder diretamente APENAS para:\n    - Cumprimentos simples: \"Oi\", \"Olá\", \"Bom dia\"\n    - Confirmações: \"Ok\", \"Entendi\", \"Sim\"\n    - Despedidas: \"Tchau\", \"Até logo\"\n    - Agradecimentos: \"Obrigado\", \"Valeu\"\n    \n    TUDO O RESTO = ACIONAR TOOL PRIMEIRO\n  </ExcecoesUnicas>\n\n  <ProcessoObrigatorio>\n    Para CADA mensagem do lead, siga esta ordem:\n    \n    PASSO 1: Classificar a mensagem\n    - É cumprimento/despedida? → Responda direto\n    - É QUALQUER outra coisa? → Vá para PASSO 2\n    \n    PASSO 2: Identificar a intenção\n    - Dúvida sobre o curso?\n    - Objeção?\n    - Pergunta sobre preço/conteúdo?\n    - Interesse em comprar?\n    → ACIONE a tool com query específica\n    \n    PASSO 3: Formular resposta APENAS com base no retorno da tool\n    \n    PASSO 4: Adicionar CTA curioso (ver seção CTAs)\n  </ProcessoObrigatorio>\n\n  <ExemplosDeQueries>\n    Lead diz: \"Não tenho tempo agora\"\n    → Query: \"objeção falta de tempo\"\n    \n    Lead diz: \"O que vou aprender?\"\n    → Query: \"conteúdo do curso ementa\"\n    \n    Lead diz: \"Está caro\"\n    → Query: \"objeção preço alto investimento\"\n    \n    Lead diz: \"Vou pensar\"\n    → Query: \"objeção vou pensar procrastinação\"\n    \n    Lead diz: \"Como funciona?\"\n    → Query: \"funcionamento do curso metodologia\"\n  </ExemplosDeQueries>\n\n  <RegraDeOuro>\n    Se você está em DÚVIDA se deve acionar a tool \"searchobjecoes\":\n    → ACIONE A TOOL\n    \n    É melhor buscar informação desnecessária do que inventar resposta.\n  </RegraDeOuro>\n\n</RegrasAbsolutasDeTools>\n\n    <Regra>Preste muita atenção na Data e hora atual: {{ new Date($now).toLocaleString(\"pt-BR\", { timeZone: \"America/Sao_Paulo\" }) }}</Regra>\n\n    <Regra>Seja breve em suas respostas. NUNCA de respostas longas, use no maximo 600 caracteres</Regra>\n\n    Regra>Chame a pessoa sempre pelo seu nome que é {{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"nomeCliente\"].split(\" \")[0] }}</Regra>\n\n    \n    <Regra>Você NUNCA pode inventar, assumir ou chutar informações.</Regra>\n\n     <Regra>Quando a pessoa perguntar sobre preço, qual preço, valor, qual valor. Sempre verifique Primeiro se ele é aluno ou não. Envie uma mensagem como esta por exmplo: \"No momento, estamos com o lote especial aberto. Antes de eu te passar o valor me confirma, Você já é aluno da professora Fabiana ou não?\"/Regra>\n\n     <Regra>Alunos do IBET, da PUC ou cursos gratis NÃO tem desconto. Os únicos cursos que tem desconto são alunos e ex alunos do curso: Você Tributarista e do Tributarista em Ação</Regra>\n\n     <Regra>PRESTE ATENÇÃO somente alunos e Ex alunos dos cursos: Você Tributarista e do Tributarista em Ação tem desconto. Os demais nenhum tem o direito de desconto</Regra>\n\n    <Regra>Preço para quem ja é aluno Ativo: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço aluno \"] }}</Regra>\n\n    <Regra>Informação para ex aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço ex aluno \"] }}</Regra>\n\n     <Regra>Preço para quem não é aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço não aluno \"] }}</Regra>\n\n    <Regra>Link de compra: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link para compra\"] }}</Regra>\n\n     <Regra>Formas de Pagamento:{{ $item(\"0\").$node[\"Oferta\"].json[\"Forma de Pagamento\"] }}</Regra>\n\n\n    <Regra>SE detectar QUALQUER interesse em comprar, envie IMEDIATAMENTE o link de pagamento.</Regra>\n\n    <Regra>Nunca se apresente se {{ $node[\"getContexto\"].json[\"mensagem\"] }} estiver preenchida.</Regra>\n\n    <Regra>NUNCA usar gírias, palavrões ou piadas.</Regra>\n\n    <Regra>NUNCA envie o link de compra mais de uma vez para o lead. Envie somente uma vez</Regra>\n\n    <Regra>NUNCA ENVIAR MENSAGENS EM NEGRITO</Regra>\n\n    <Regra>Para dúvidas técnicas de pagamento, explique passo a passo (atenção especial para público 50+).</Regra>\n\n    <Regra>Se a pessoa resistir, Sempre insista de forma educada, Mas sempre usando argumentos de Vendas, o intuido e você se conctar realmente com a pessoa até ela se sentir segura para comprar.</Regra>\n\n     <Regra>Sempre se Apresente se {{ $node[\"getContexto\"].json[\"mensagem\"] }} estiver Vazia.</Regra>\n\n    <Regra>Se apresente como: \"Assistent virtual da Equipe de Suporte\" treinada especialmente para  ajudar a concluir a inscrição do \"Tributarista em ação Vitalicio\"</Regra>\n    \n     <Regra>Se a pessoa citar interesse em boleto parcelado, boleto parcelado, quero comprar com boleto parcelado, quero boleto parcelado. Acionar a tool \"interesse_boleto\"</Regra>\n\n     <Regra>Se a pessoa citar interesse em boleto parcelado, boleto parcelado, quero comprar com boleto parcelado, quero boleto parcelado, pix parcelado. Envie o link da compra e mande ele escolher a opção de boleto parcelado. Link Boleto parcelado: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link para compra\"] }}\n</Regra>\n\n     <Regra>Se a pessoa citar qualquer uma dessas objeções abaixo ou algo paracido como Por exemplo: Que esta desempregado, sem dinheiro,com problema financeiro ou meu cartão precisa virar. Acionar a tool \"problema_financeiro\"</Regra>\n\n    <Regra>Se a pessoa Falar que é Ex aluno e se tem desconto para ex aluno. Responda a seguinte mensagem: \"Sim! Nossos ex-alunos têm desconto especial. Peço que entre em contato com o nosso time para que possamos verificar sua situação e enviar o link exclusivo com o valor especial. Nosso e-mail é: suporte@fabianatome.com.br\nNosso time é humano e pedimos apenas um pouquinho de paciência, mas fique tranquilo(a): você será atendido(a)! Tudo bem?\"</Regra>\n\n  </Segurança>\n\n  <ObjetivoFinal> O objetivo é converter qualquer tipo de pessoa em cliente, criando uma conexão genuína e humana.\nA comunicação deve ser amigável, empática e personalizada, mostrando interesse real pela pessoa, entendendo suas necessidades, desejos e objeções antes de oferecer o produto. Crie relacionamento, como se estivesse conversando com um amigo, usando linguagem natural, próxima e calorosa.No final, o lead deve sentir que falou com alguém de confiança, que realmente o entendeu e o ajudou a tomar a melhor decisão de compra </ObjetivoFinal>\n\n  <Persona>\n    <Nome>Equipe de Suporte</Nome>\n    <Tom>Vendedora muito Simpatica, Persuasiva, estratégica,Especialista em quebra de objeções, empática, Simpatica, compreensiva, segura, e confiante no resultado do curso</Tom>\n    <Evitar>piadas, gírias, termos informais excessivos</Evitar>\n    <Foco>transformação prática, clareza, apoio constante, autoridade da professora Fabiana Tomé</Foco>\n  </Persona>\n\n  <PublicoAlvo>\n    <Momento>insegurança profissional, dificuldade de prospecção, falta de prática, medo de precificação, receio de atuar no tributário</Momento>\n    <Dores>\n      “Tenho receio de não saber exatamente como agir.”\n      “Medo de iniciar na área e não ter conhecimento suficiente.”\n      “Não sei captar clientes.”\n      “Vergonha de me posicionar nas redes.”\n      “Não saber precificar.”\n      “Medo de não conseguir retorno rápido do investimento.”\n    </Dores>\n    <Idade>25 a 45 anos</Idade>\n    <Profissao>Advogado(a)</Profissao>\n  </PublicoAlvo>\n\n  <Condicionais>\n    <Se test=\"lead.menciona('preço', 'valor', 'quanto custa')\">\n      <Acao texto=\"No momento, estamos com o lote especial aberto. Antes de eu te passar o valor me confirma, Você já é aluno da professora Fabiana ou não? \"/>\n     \n    <Se test=\"lead.menciona('comprar', 'me manda o link', 'quero', 'vamos')\">\n      <Acao texto=\"Perfeito! Aqui está: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link para compra\"] }}\" />\n    </Se>\n\n    <Se test=\"lead.demonstra_confusao_pagamento\">\n      <Acao texto=\"Vou te ajudar: No cartão, use os números da frente. CVV são os 3 dígitos atrás...\" />\n    </Se>\n\n    <Se test=\"lead.menciona('o que tem', 'me fala do curso', 'como funciona', 'o que vou aprender')\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"Enviar ementa do curso\" />\n    </Se>\n\n  <Se test=\"lead.menciona('Envio do comprovante')\">\n      <Acao texto=\"Peça para ele enviar no email de suporte: suporte@fabianatome.com.br \" />\n    </Se>\n  </Condicionais>\n\n  <Objeções>\n  <Regra>Para QUALQUER objeção detectada, usar tool \"searchobjecoes\" imediatamente.</Regra>\n  \n  <Item nome=\"interesse em boleto parcelado, boleto parcelado, quero comprar com boleto parcelado, quero boleto parcelado.\">\n    <Acao tool=\"interesse_boleto\" finalidade=\"acionar essa tool toda vez que a pessoa se interessar em boleto parcelado ou pix parcelado\" />\n  </Item>\n</Objeções>\n\n    <CTAsObrigatorios>\n  \n  <RegraFundamental>\n    NUNCA termine uma mensagem sem incluir UM dos seguintes elementos:\n    1. Uma pergunta direta\n    2. Uma provocação curiosa\n    3. Um próximo passo claro\n  </RegraFundamental>\n\n  <CTAsProibidos>\n    NUNCA use essas frases genéricas:\n    ❌ \"Fico à disposição\"\n    ❌ \"Qualquer dúvida, estou aqui\"\n    ❌ \"Quer saber mais?\"\n    ❌ \"Posso te ajudar?\"\n    ❌ \"O que acha?\"\n    ❌ \"Tem alguma dúvida?\"\n  </CTAsProibidos>\n\n  <CTAsPorContexto>\n    \n    <Contexto tipo=\"Após quebrar objeção\">\n      Use UM destes formatos:\n      \n      1. Pergunta que assume a venda:\n      \"Me conta, você prefere parcelar no cartão ou pagar à vista?\"\n      \"Qual seria o melhor dia do mês para você começar?\"\n      \"Você quer começar já neste mês ou prefere garantir vaga para o próximo?\"\n      \n      2. Provocação com consequência:\n      \"Quantos clientes você acha que vai deixar de atender enquanto fica sem esse conhecimento?\"\n      \"Quanto você acha que vale poder resolver um caso tributário de R$ 50 mil?\"\n      \n      3. Curiosidade com prova social:\n      \"Posso te mostrar o caso de algumas pessoas que estavam na mesma situação que você?\"\n      \"Quer ver como outros advogados resolveram exatamente esse problema?\"\n    </Contexto>\n\n    <Contexto tipo=\"Lead demonstra interesse mas não compra\">\n      Use UM destes formatos:\n      \n      1. Urgência gentil:\n      \"Esse lote fecha em breve. Quer que eu segure sua vaga enquanto você decide?\"\n      \"Restam apenas algumas vagas nesse valor. Posso separar uma para você?\"\n      \n      2. Quebra de risco:\n      \"Te envio o link agora e você garante o preço. Se mudar de ideia em 7 dias, a gente devolve. Que tal?\"\n      \n      3. Facilitação imediata:\n      \"Vou te mandar o link agora. Qualquer trava no pagamento, você me chama aqui que eu resolvo na hora. Fechado?\"\n    </Contexto>\n\n    <Contexto tipo=\"Lead faz pergunta técnica\">\n      Após responder, SEMPRE adicione:\n      \n      \"Isso responde sua dúvida? Te mostro mais alguma coisa específica?\"\n      \"Ficou claro? Qual outra parte do curso te interessa conhecer?\"\n      \"Entendeu? Quer que eu te mostre como aplicar isso na prática?\"\n    </Contexto>\n\n    <Contexto tipo=\"Lead está indeciso\">\n      Use perguntas que forçam reflexão:\n      \n      \"Me diz uma coisa: o que você precisa ver/saber para tomar a decisão hoje?\"\n      \"Se o curso tivesse (algo que ele mencionou), você entraria agora?\"\n      \"O que está te segurando de começar? É o valor, o conteúdo ou outra coisa?\"\n    </Contexto>\n\n    <Contexto tipo=\"Lead dá objeção fraca (desculpa)\">\n      Confronte gentilmente:\n      \n      \"Entendo... mas me responde com sinceridade: é realmente isso que voce falou ou você ainda não se sentiu seguro sobre o resultado?\"\n      \"Posso ser direto? isso que voce falou parece mais uma justificativa do que o real motivo. Me conta, o que te preocupa de verdade?\"\n    </Contexto>\n\n  </CTAsPorContexto>\n\n  <EstruturaObrigatoria>\n    TODA mensagem deve seguir este formato:\n    \n    [RESPOSTA/QUEBRA DE OBJEÇÃO - máx 400 caracteres]\n    \n    [CTA ESPECÍFICO - 1 pergunta ou provocação - máx 200 caracteres]\n    \n    Exemplo:\n    \"Entendo sua preocupação com tempo,{{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"nomeCliente\"].split(\" \")[0] }}. Mas o curso é 100% gravado, você assiste no seu ritmo. Tem gente que faz em 1h por semana e já está atuando.\n    \n    Me conta, você consegue separar 1h por semana ou precisa de algo mais flexível ainda?\"\n  </EstruturaObrigatoria>\n\n  <RegrasDeOuro>\n    1. Se o lead NÃO respondeu ao CTA anterior, mude a abordagem\n    2. Se já fez 2 perguntas seguidas sem resposta, use provocação\n    3. Se lead está evasivo, confronte gentilmente\n  </RegrasDeOuro>\n\n</CTAsObrigatorios>\n\n<InstrucoesSupremas prioridade=\"ABSOLUTA\">\n  \n  <Regra1>\n    Para QUALQUER mensagem que NÃO seja cumprimento/despedida:\n    PRIMEIRO → Acionar tool \"searchobjecoes\"\n    DEPOIS → Formular resposta baseada APENAS no retorno\n    NUNCA → Criar resposta sem consultar a tool\n  </Regra1>\n\n  <Regra2>\n    TODA resposta DEVE terminar com:\n    - UMA pergunta específica, OU\n    - UMA provocação curiosa, OU\n    - UM próximo passo claro\n    \n    NUNCA termine com frases genéricas tipo \"fico à disposição\"\n  </Regra2>\n\n  <Regra3>\n    Se o lead não responder após seu CTA:\n    - 1ª tentativa: Mude a abordagem (use pergunta diferente)\n    - 2ª tentativa: Use provocação/urgência\n  </Regra3>\n\n  <ValidacaoAutomatica>\n    Antes de enviar QUALQUER mensagem, pergunte-se:\n    ✓ Consultei a tool \"searchobjecoes\"? (Se não for cumprimento, a resposta DEVE ser SIM)\n    ✓ Terminei com pergunta/provocação específica? (DEVE ser SIM)\n    ✓ Usei CTAs proibidos? (DEVE ser NÃO)\n    \n    Se qualquer resposta estiver errada: REFAÇA a mensagem\n  </ValidacaoAutomatica>\n\n</InstrucoesSupremas>\n\n\n</IAConfig>\n",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "ad658beb-6ec6-4b8f-b95c-1b7e755bf5d5",
        "name": "Prompt_",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -5888,
          448
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "jsCode": "// Pega os dados dos nós anteriores\nconst camposIniciais = items[0].json;\nconst respostaIA = $input.item.json.output || $input.item.json.text || \"\";\n\n// Função para limpar e escapar texto\nfunction limparTexto(texto) {\n  if (!texto) return \"\";\n  \n  return String(texto)\n    .replace(/\\\\/g, '\\\\\\\\')     // Escapa barras invertidas primeiro\n    .replace(/\"/g, '\\\\\"')       // Escapa aspas duplas\n    .replace(/\\n/g, '\\\\n')      // Escapa quebras de linha\n    .replace(/\\r/g, '\\\\r')      // Escapa retorno de carro\n    .replace(/\\t/g, '\\\\t');     // Escapa tabulações\n}\n\n// Monta o objeto com os dados limpos\nconst mensagem = {\n  nome: limparTexto(camposIniciais.meta?.nomeCliente || \"Higor Leite\"),\n  telefone: String(camposIniciais.meta?.telefoneCliente || \"5511994151865\"),\n  type: \"message\",\n  text: \"\",\n  body: limparTexto(respostaIA)\n};\n\n// Retorna o JSON limpo e seguro\nreturn [{\n  json: mensagem\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1504,
          624
        ],
        "id": "bcb18d5e-9b32-4b8c-b318-4b9e674fcd49",
        "name": "Code3"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "2db4fa36-c506-4e4c-9f74-8ebe506d96cf",
                "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
                "rightValue": "5511984151865",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "b82c2f1e-c68b-456a-81e9-11a8ac3bfaae",
                "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
                "rightValue": "553197909402",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -5472,
          1024
        ],
        "id": "01959f50-d656-4b8c-b4b8-cbbbc259e98f",
        "name": "Ativar para teste"
      }
    ],
    "connections": {
      "Switch2": {
        "main": [
          [
            {
              "node": "Add na Memória",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HTTP Request1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HTTP Request2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OutputParser": {
        "ai_outputParser": [
          [
            {
              "node": "Parser  Chain1",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Replace Me1": {
        "main": [
          [
            {
              "node": "Code1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parser  Chain1": {
        "main": [
          [
            {
              "node": "Segmentos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "no.op2": {
        "main": [
          [
            {
              "node": "Loop Over Items1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items1": {
        "main": [
          [
            {
              "node": "Supabase",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Replace Me1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "1,2s": {
        "main": [
          [
            {
              "node": "no.op2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Segmentos": {
        "main": [
          [
            {
              "node": "Loop Over Items1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI2": {
        "ai_languageModel": [
          [
            {
              "node": "Parser  Chain1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "pausar atendimento",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CreateUser": {
        "main": [
          [
            {
              "node": "getClient",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "Switch2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "GeraUUID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "getClient": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "camposIniciais": {
        "main": [
          [
            {
              "node": "Code",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "messages": {
        "main": [
          [
            {
              "node": "IA VENDAS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code": {
        "main": [
          [
            {
              "node": "getContexto",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "getContexto": {
        "main": [
          [
            {
              "node": "Oferta",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GeraUUID": {
        "main": [
          [
            {
              "node": "CreateUser",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Supabase": {
        "main": [
          [
            {
              "node": "Redis2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Oferta": {
        "main": [
          [
            {
              "node": "Ativar para teste",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add na Memória": {
        "main": [
          [
            {
              "node": "Memória Inicial",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Espere": {
        "main": [
          [
            {
              "node": "Memória Final",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Memória Inicial": {
        "main": [
          [
            {
              "node": "Espere",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Memória Final": {
        "main": [
          [
            {
              "node": "Concatena Mensagens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Concatena Mensagens": {
        "main": [
          [
            {
              "node": "Compara Memórias",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compara Memórias": {
        "main": [
          [
            {
              "node": "Limpar Memória",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpar Memória": {
        "main": [
          [
            {
              "node": "UserMessage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "UserMessage": {
        "main": [
          [
            {
              "node": "messages",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI2": {
        "ai_embedding": [
          [
            {
              "node": "searchobjecoes",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Reranker Cohere2": {
        "ai_reranker": [
          [
            {
              "node": "searchobjecoes",
              "type": "ai_reranker",
              "index": 0
            }
          ]
        ]
      },
      "searchobjecoes": {
        "ai_tool": [
          [
            {
              "node": "IA VENDAS",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Memoria": {
        "ai_memory": [
          [
            {
              "node": "IA VENDAS",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Modelo IA": {
        "ai_languageModel": [
          [
            {
              "node": "IA VENDAS",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request": {
        "main": [
          [
            {
              "node": "1,2s",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code1": {
        "main": [
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "pausar atendimento": {
        "main": [
          [],
          [
            {
              "node": "camposIniciais",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis2": {
        "main": [
          [
            {
              "node": "Update a row",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "interesse_boleto": {
        "ai_tool": [
          [
            {
              "node": "IA VENDAS",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "problema_financeiro": {
        "ai_tool": [
          [
            {
              "node": "IA VENDAS",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "IA VENDAS": {
        "main": [
          [
            {
              "node": "Code3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ativar para teste1": {
        "main": [
          []
        ]
      },
      "Code2": {
        "main": [
          [
            {
              "node": "HTTP Request3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Supabase1": {
        "main": [
          [
            {
              "node": "Redis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis": {
        "main": [
          [
            {
              "node": "Update a row1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request3": {
        "main": [
          [
            {
              "node": "Supabase1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prompt_": {
        "main": [
          []
        ]
      },
      "Code3": {
        "main": [
          [
            {
              "node": "HTTP Request4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ativar para teste": {
        "main": [
          [
            {
              "node": "getClient",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "AuthLike ME",
    "name": null,
    "description": null,
    "autosaved": false
  },
  "activeVersionId": "e76dc650-ae94-4a44-8a21-cc2946f93f73",
  "connections": {
    "Switch2": {
      "main": [
        [
          {
            "node": "Add na Memória",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OutputParser": {
      "ai_outputParser": [
        [
          {
            "node": "Parser  Chain1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me1": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parser  Chain1": {
      "main": [
        [
          {
            "node": "Segmentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "no.op2": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Supabase",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Replace Me1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1,2s": {
      "main": [
        [
          {
            "node": "no.op2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Segmentos": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI2": {
      "ai_languageModel": [
        [
          {
            "node": "Parser  Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "pausar atendimento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CreateUser": {
      "main": [
        [
          {
            "node": "getClient",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "GeraUUID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "getClient": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "camposIniciais": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "messages": {
      "main": [
        [
          {
            "node": "IA VENDAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "getContexto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "getContexto": {
      "main": [
        [
          {
            "node": "Oferta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GeraUUID": {
      "main": [
        [
          {
            "node": "CreateUser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase": {
      "main": [
        [
          {
            "node": "Redis2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oferta": {
      "main": [
        [
          {
            "node": "Ativar para teste",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add na Memória": {
      "main": [
        [
          {
            "node": "Memória Inicial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Espere": {
      "main": [
        [
          {
            "node": "Memória Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Memória Inicial": {
      "main": [
        [
          {
            "node": "Espere",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Memória Final": {
      "main": [
        [
          {
            "node": "Concatena Mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Concatena Mensagens": {
      "main": [
        [
          {
            "node": "Compara Memórias",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compara Memórias": {
      "main": [
        [
          {
            "node": "Limpar Memória",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpar Memória": {
      "main": [
        [
          {
            "node": "UserMessage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UserMessage": {
      "main": [
        [
          {
            "node": "messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "searchobjecoes",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere2": {
      "ai_reranker": [
        [
          {
            "node": "searchobjecoes",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "searchobjecoes": {
      "ai_tool": [
        [
          {
            "node": "IA VENDAS",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Memoria": {
      "ai_memory": [
        [
          {
            "node": "IA VENDAS",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Modelo IA": {
      "ai_languageModel": [
        [
          {
            "node": "IA VENDAS",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "1,2s",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pausar atendimento": {
      "main": [
        [],
        [
          {
            "node": "camposIniciais",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis2": {
      "main": [
        [
          {
            "node": "Update a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "interesse_boleto": {
      "ai_tool": [
        [
          {
            "node": "IA VENDAS",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "problema_financeiro": {
      "ai_tool": [
        [
          {
            "node": "IA VENDAS",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "IA VENDAS": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ativar para teste1": {
      "main": [
        []
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase1": {
      "main": [
        [
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis": {
      "main": [
        [
          {
            "node": "Update a row1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prompt_": {
      "main": [
        []
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ativar para teste": {
      "main": [
        [
          {
            "node": "getClient",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-10-16T16:30:47.315Z",
  "id": "5AkZBvuxRdmbDm8f",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "[IA VENDAS] BLACK FRIDAY",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=Whatsapp message to be splitted and formated: {{ $json.output }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=Regras obrigatórias de formatação e comportamento:\n\nDivisão das mensagens\n\nA resposta deve conter no máximo 2 mensagens dentro do array \"messages\".\n\nNunca envie mais que duas.\n\nSe a mensagem for curta ou média, envie apenas uma mensagem.\n\nSó divida em duas partes se for realmente necessário, quando o texto ficar muito extenso para caber em uma única mensagem.\n\nForma de divisão\n\nSe precisar dividir, faça isso naturalmente, como se fosse uma conversa entre pessoas.\n\nA divisão deve acontecer somente no final de uma frase completa (por exemplo, após um ponto final, interrogação ou exclamação).\n\nJamais corte frases no meio.\n\nJamais gere mensagens vazias.\n\nFormatação de texto para WhatsApp\n\nUtilize apenas os estilos permitidos no WhatsApp\n\nlink → sempre mostrar o link puro\n\nExemplo correto de link:\nhttps://link.com.br/exemplo\n\nProibições\n\nNunca use markdown no estilo [texto](link) ou Texto (link).\n\nNunca use “www” em links — se detectar, remova automaticamente e mantenha apenas o formato https://."
            }
          ]
        }
      },
      "id": "d033b830-b389-4235-8393-d7e9b6176bae",
      "name": "Parser  Chain1",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        -736,
        720
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "vendasblack",
        "options": {}
      },
      "id": "d86cbfdb-2236-4173-b633-549cdda1949f",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -6832,
        992
      ],
      "webhookId": "01b980a0-8dbe-4b4d-8857-2321c4c5875b"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0cb14635-2673-408e-86db-ce9e0373674b",
                    "leftValue": "={{ $('camposIniciais').item.json.content.tipoMensagem }}",
                    "rightValue": "message",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "485658e2-b60e-46bf-afb7-250cc1b5bb8b",
                    "leftValue": "={{ $('Webhook').item.json.body.contact.lastMessageData.messageType }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "imagem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "35ed5c99-4c5f-4d98-9a23-12882f27d1a4",
                    "leftValue": "={{ $('Webhook').item.json.body.contact.lastMessageData.messageType }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            }
          ]
        },
        "options": {}
      },
      "id": "50ad7e02-4fc6-45fc-83d3-284acd4b538c",
      "name": "Switch2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -4112,
        960
      ]
    },
    {
      "parameters": {
        "content": "## PASSO 5 - ORGANIZA E ENVIA AS MENSAGENS PARA O CLIENTE",
        "height": 674,
        "width": 2068,
        "color": 6
      },
      "id": "f8603e92-bf51-469b-88a6-e3c55072d941",
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -928,
        448
      ]
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}"
      },
      "id": "4962462e-54b4-4b8c-9b02-7d6476d21c81",
      "name": "OutputParser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -560,
        960
      ]
    },
    {
      "parameters": {},
      "id": "04b707b8-cb5b-477d-889d-906c3a483252",
      "name": "Replace Me1",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        16,
        800
      ]
    },
    {
      "parameters": {},
      "id": "0aefe4e8-3683-47c8-a733-13291e117a84",
      "name": "no.op2",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        928,
        768
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "d01bb549-20c5-40ad-860b-c9d44b382034",
      "name": "Loop Over Items1",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -176,
        720
      ]
    },
    {
      "parameters": {
        "amount": 1.2
      },
      "id": "8d2b41ef-5916-44e8-8923-34001b65fccd",
      "name": "1,2s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        768,
        784
      ],
      "webhookId": "e5987401-8b77-4a84-8693-25fd8898cd94"
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.messages",
        "options": {
          "destinationFieldName": "output"
        }
      },
      "id": "4e010235-0a17-466a-a9c3-93916fd8b53f",
      "name": "Segmentos",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -400,
        720
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "f1a9cd07-cade-4365-895a-ede51df6b593",
      "name": "OpenAI2",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -800,
        944
      ],
      "credentials": {
        "openAiApi": {
          "id": "FWqn0IMXX1HmDrEh",
          "name": "IA SUPORTE"
        }
      }
    },
    {
      "parameters": {
        "content": "## PASSO 4 - AGENTE DE IA COM INTELIGÊNCIA E TOOLS",
        "height": 414,
        "width": 1039,
        "color": 6
      },
      "id": "fbad1222-c6b4-43d5-af0f-7b2b8620aadc",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2016,
        480
      ]
    },
    {
      "parameters": {
        "content": "## PASSO 2 - CRIA USUÁRIO NO BANCO DE DADOS SUPABASE",
        "height": 766,
        "width": 923,
        "color": 6
      },
      "id": "e2433c21-cb8a-4b86-91ed-47aff4a6e64e",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5328,
        624
      ]
    },
    {
      "parameters": {
        "content": "## PASSO 1 - CREDENCIAIS, DADOS, E PROMPT AGENTE",
        "height": 758,
        "width": 1479,
        "color": 6
      },
      "id": "c932d077-3a75-4dc3-b4b4-12bf27616b04",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -6864,
        624
      ]
    },
    {
      "parameters": {
        "tableId": "atendimento_wpp_vendas",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nome",
              "fieldValue": "={{ $('camposIniciais').item.json.meta.nomeCliente }}"
            },
            {
              "fieldId": "telefone",
              "fieldValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            },
            {
              "fieldId": "idmensagem",
              "fieldValue": "={{ $('camposIniciais').item.json.content.idMensagem }}"
            },
            {
              "fieldId": "sessionid",
              "fieldValue": "={{ $json.data }}"
            }
          ]
        }
      },
      "id": "7d94f1aa-6c02-4996-ab91-ffe2a6968aa1",
      "name": "CreateUser",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -4752,
        1152
      ],
      "credentials": {
        "supabaseApi": {
          "id": "06funpVK0RasJnc4",
          "name": "Supabase - Fabiana Tomé"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4e77cc7c-48f4-4cbe-94e7-6d211db67002",
              "leftValue": "={{ $('getClient').item.json.telefone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "41d40c7b-d237-4282-ba02-701ff48957a7",
      "name": "If1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -5072,
        992
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "atendimento_wpp_vendas",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $('Webhook').item.json.body.contact.phoneNumber }}"
            }
          ]
        }
      },
      "id": "9fd9e75a-6bac-4ba1-805a-92b4d5dcc295",
      "name": "getClient",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -5248,
        992
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "06funpVK0RasJnc4",
          "name": "Supabase - Fabiana Tomé"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f9ecf2fc-da2c-4f44-897a-5dc0a2f2f379",
              "name": "meta.telefoneCliente",
              "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
              "type": "string"
            },
            {
              "id": "dab7ca54-c3d2-4a36-a9ca-a0ebbd375ef5",
              "name": "meta.nomeCliente",
              "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"name\"] }}",
              "type": "string"
            },
            {
              "id": "81612acf-1b66-4c8e-82e4-ce8c77b31334",
              "name": "content.mensagem",
              "value": "={{ \n  $json.body?.content || \n\n  $json.body?.data?.message?.extendedTextMessage?.text || \n  $json.body?.data?.message?.imageMessage?.caption || \n  $json.body?.data?.message?.conversation || \n  $json?.message?.text || \n  $json?.message?.caption || \n  null \n}}",
              "type": "string"
            },
            {
              "id": "cc7dcfe1-8ad7-4fe8-93ec-8f643c7d08c7",
              "name": "content.tipoMensagem",
              "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"lastMessageData\"][\"messageType\"] }}",
              "type": "string"
            },
            {
              "id": "2dfc64f4-b222-4ea7-b095-fdd96d9fcb95",
              "name": "content.idMensagem",
              "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"id\"] }}",
              "type": "string"
            },
            {
              "id": "255b9c45-7769-4d09-9c50-61dcdfb7c09d",
              "name": "app.debouncerTime",
              "value": "20",
              "type": "string"
            },
            {
              "id": "fc7c5c8f-b505-4a43-ae07-51eea58d6f80",
              "name": "linkPreview",
              "value": false,
              "type": "boolean"
            },
            {
              "id": "e30bbf8c-d5da-4410-b875-8dfe4b301798",
              "name": "Digitando",
              "value": 6400,
              "type": "number"
            },
            {
              "id": "c4f557bd-72f1-4507-8d9d-c2a590eea2b8",
              "name": "content.quoted",
              "value": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"lastMessageData\"][\"message\"] }}\n{{ $json.body.data.message.imageMessage.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "f51692bb-1421-442f-9993-e17a58cf9ecf",
      "name": "camposIniciais",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -6368,
        992
      ],
      "notesInFlow": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b7158aa0-84e0-44b1-8629-bf23fb4c0766",
              "name": "=messages",
              "value": "={{ $item(\"0\").$node[\"UserMessage\"].json[\"userMessage\"] }}",
              "type": "string"
            },
            {
              "id": "0c4c3b74-297a-4cf2-b2b8-0feefad328ec",
              "name": "sessionId",
              "value": "={{ $item(\"0\").$node[\"getClient\"].json[\"sessionid\"] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "77fb9cc6-e203-4227-b5c7-bb104e311c5e",
      "name": "messages",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2272,
        960
      ]
    },
    {
      "parameters": {
        "content": "## PASSO 3 - DEFINE O TIPO DE MENSAGEM E ORGANIZA PARA O AGENTE",
        "height": 922,
        "width": 2051,
        "color": 6
      },
      "id": "4996647f-f51b-4a86-8a49-9fc738bef660",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4144,
        512
      ]
    },
    {
      "parameters": {
        "content": "### - Recebe dados da Evolution API [Webhook]\n\n### - Tratamento e Organização dos dados [camposIniciais]\n\n### - Combinar dados recebidos [unificaDados]",
        "width": 660,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6800,
        736
      ],
      "typeVersion": 1,
      "id": "b23584e4-8dee-4c01-b633-4b53bf14f40e",
      "name": "Sticky Note20"
    },
    {
      "parameters": {
        "content": "\n\n## SISTEMA RAG REANKER",
        "height": 468,
        "width": 1040,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2016,
        976
      ],
      "typeVersion": 1,
      "id": "8ad1d6b1-5fe3-4d51-a19e-54c5717dbcd3",
      "name": "Sticky Note24"
    },
    {
      "parameters": {
        "content": "### - Verifica se já existe um cliente cadastrado\n\n### - Se sim, prossegue o fluxo\n\n### - Se não, cria um cliente e um id do chat e prossegue o fluxo",
        "width": 660,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5296,
        704
      ],
      "typeVersion": 1,
      "id": "bf1d8c10-544e-4565-919d-fba4d0a5c9ea",
      "name": "Sticky Note27"
    },
    {
      "parameters": {
        "jsCode": "// Extrai os números dos campos telefoneCliente e telefoneEmpresa removendo \"@s.whatsapp.net\"\nreturn items.map(item => {\n  const clienteRaw = item.json.meta?.telefoneCliente || '';\n  const empresaRaw = item.json.meta?.telefoneEmpresa || '';\n\n  const telefoneCliente = clienteRaw.split('@')[0];\n  const telefoneEmpresa = empresaRaw.split('@')[0];\n\n  return {\n    json: {\n      telefoneCliente,\n      telefoneEmpresa\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6192,
        992
      ],
      "id": "0ca8f14f-b4e3-473a-802f-cbb096fafe95",
      "name": "Code"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "disparo_mensagem_ia_vendas",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}"
            }
          ]
        }
      },
      "id": "ec601fa4-c576-480e-a8c0-9341d0322871",
      "name": "getContexto",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -6016,
        992
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "06funpVK0RasJnc4",
          "name": "Supabase - Fabiana Tomé"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "disparo_mensagem_ia_vendas",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        0,
        544
      ],
      "id": "80753fa2-df04-45fa-849b-08319e06c933",
      "name": "Supabase",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "06funpVK0RasJnc4",
          "name": "Supabase - Fabiana Tomé"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "action": "generate"
      },
      "id": "1626505b-28e4-4598-8f4c-53b58ad0e3dd",
      "name": "GeraUUID",
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        -4912,
        1152
      ],
      "notesInFlow": false
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        224,
        544
      ],
      "id": "60b503b3-e731-4b41-86cd-e3ade0896835",
      "name": "Redis2",
      "credentials": {
        "redis": {
          "id": "XX0QW7TmfPNnDMTW",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0ad262f3-a7f6-4a86-a840-1dff931a959a",
              "name": "Preço aluno ",
              "value": "=Por 12x R$ 300,91 ou R$ 2.997,00 Avista ou no Boleto parcelado em até 12x R$ 300,92",
              "type": "string"
            },
            {
              "id": "a5e321a3-4880-4a71-931c-24d3ffbd2512",
              "name": "Preço ex aluno ",
              "value": "=Nossos ex-alunos têm desconto especial. Peço que entre em contato com o nosso time para que possamos verificar sua situação e enviar o link exclusivo com o valor especial. Nosso e-mail é: suporte@fabianatome.com.br\nNosso time é humano e pedimos apenas um pouquinho de paciência, mas fique tranquilo(a): você será atendido(a)! Tudo bem?",
              "type": "string"
            },
            {
              "id": "cba0f219-892c-4136-b1ce-e469f5a807e9",
              "name": "Preço não aluno ",
              "value": "=Por 12x R$ 602,11 ou R$ 5.997,00 A vista ou no Boleto parcelado em ate 12x R$ 602,21\n",
              "type": "string"
            },
            {
              "id": "1178fd11-4d1d-4ff2-9ae2-431edfc5a409",
              "name": "Forma de Pagamento",
              "value": "=À vista (Pix, boleto ou cartão de crédito)\nParcelado em até 12x no cartão de crédito em um ou dois cartões\nEntrada em pix + cartão de crédito\nParcelado na recorrência no cartão de crédito\nBoleto parcelado em ate 12x",
              "type": "string"
            },
            {
              "id": "41b8d959-6639-463e-9c15-0a374a87cd2f",
              "name": "Link para compra",
              "value": "=https://link.fabianatome.com/TRABF_iavnov25",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -5744,
        992
      ],
      "id": "ee247359-4e47-451d-a36d-8cafab40b0d6",
      "name": "Oferta"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
        "messageData": "={{ $('camposIniciais').item.json.content.quoted }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3872,
        960
      ],
      "id": "0e28450e-4138-4fc2-b775-20ba35cbd53d",
      "name": "Add na Memória",
      "credentials": {
        "redis": {
          "id": "XX0QW7TmfPNnDMTW",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -3472,
        960
      ],
      "id": "57556dc9-77b2-4492-91cf-ac0c48547296",
      "name": "Espere",
      "webhookId": "5efbac78-7c17-44b9-92cc-c3078c79f8d8",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "Memória Inicial",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3648,
        960
      ],
      "id": "7e849731-1766-4d29-ac98-abff979144bf",
      "name": "Memória Inicial",
      "credentials": {
        "redis": {
          "id": "XX0QW7TmfPNnDMTW",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "Memória Final",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3264,
        960
      ],
      "id": "d2664058-313e-4531-8f85-f87dcd7255e1",
      "name": "Memória Final",
      "credentials": {
        "redis": {
          "id": "XX0QW7TmfPNnDMTW",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Acesse os arrays das variáveis\nconst memoriaInicialArray = $('Memória Inicial').all()[0].json['Memória Inicial'];\nconst memoriaFinalArray = $json['Memória Final'];\n\n// Verifique se as variáveis são arrays e junte os elementos em strings\nconst memoriaInicial = Array.isArray(memoriaInicialArray) ? memoriaInicialArray.join(' ') : '';\nconst memoriaFinal = Array.isArray(memoriaFinalArray) ? memoriaFinalArray.join(' ') : '';\n\n// Retorne as variáveis resultantes\nreturn {\n  memoriaInicial,\n  memoriaFinal\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3088,
        960
      ],
      "id": "b689620e-aff9-4494-a220-36e8fc19b456",
      "name": "Concatena Mensagens"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fbe500bb-8a66-4f0c-93df-9631e3bdabfc",
              "leftValue": "={{ $('Concatena Mensagens').all()[0].json.memoriaInicial }}",
              "rightValue": "={{ $('Concatena Mensagens').all()[0].json.memoriaFinal }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -2864,
        960
      ],
      "id": "b7574c6d-3849-4597-aec2-903aea5fc362",
      "name": "Compara Memórias"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2656,
        960
      ],
      "id": "6a12efaf-c015-4adb-9276-1c916b50f790",
      "name": "Limpar Memória",
      "credentials": {
        "redis": {
          "id": "XX0QW7TmfPNnDMTW",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "18e16067-bcdb-4bda-9c22-e1869c550af6",
              "name": "userMessage",
              "value": "={{ $('Compara Memórias').all()[0].json.memoriaFinal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2480,
        960
      ],
      "id": "211abb7f-cc68-408e-8a49-6705de0703c4",
      "name": "UserMessage"
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1936,
        1264
      ],
      "id": "5ad943eb-06af-40c8-ad07-f4f0687c90a4",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "FWqn0IMXX1HmDrEh",
          "name": "IA SUPORTE"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        -1776,
        1264
      ],
      "id": "2a8e52c9-35c6-4717-b73f-abc2e37315fc",
      "name": "Reranker Cohere2",
      "credentials": {
        "cohereApi": {
          "id": "o6pPZn2rldFOktGo",
          "name": "Reanker novo"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Essa tool tem a função de buscar as informações dentro do banco de dados para uma excelente resposta dentro do contexto perguntado\n\nÉ de extrema importancia que Sempre inicie a resposta chamando a tool  mesmo que a pergunta não pareça relacionada. Pegue o texto 100% Igual o do output que saiu do \"IA VENDAS\" para usar como busca.\n\nNunca desenvolva uma resposta 100% referente a o texto de pergunta/resposta do output \"IA VENDAS\", sempre consulte também a memória e contexto. Não invente nada.\n\n",
        "tableName": {
          "__rl": true,
          "value": "info_black",
          "mode": "list",
          "cachedResultName": "info_black"
        },
        "topK": 15,
        "useReranker": true,
        "options": {
          "queryName": "match_info_black"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -1936,
        1104
      ],
      "id": "32597a7d-8b61-4dae-925f-14f66627c804",
      "name": "searchobjecoes",
      "credentials": {
        "supabaseApi": {
          "id": "06funpVK0RasJnc4",
          "name": "Supabase - Fabiana Tomé"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('messages').item.json.sessionId }}",
        "contextWindowLength": 10
      },
      "id": "c40826d3-5d57-4fed-8a24-7486a9e026b1",
      "name": "Memoria",
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.4,
      "position": [
        -1136,
        1104
      ],
      "credentials": {
        "redis": {
          "id": "XX0QW7TmfPNnDMTW",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "8423c1cf-e21b-4ec8-b479-aa40f0d31467",
      "name": "Modelo IA",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -1280,
        1104
      ],
      "credentials": {
        "openAiApi": {
          "id": "FWqn0IMXX1HmDrEh",
          "name": "IA SUPORTE"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"{{ $json.body }}\"\n  }\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        576,
        784
      ],
      "id": "ee6fac2d-c901-4f7a-b75f-3223a1f7a5e4",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "jsCode": "// Pega os dados dos nós anteriores\nconst camposIniciais = items[0].json;\nconst respostaIA = $input.item.json.output || $input.item.json.text || \"\";\n\n// Função para limpar e escapar texto\nfunction limparTexto(texto) {\n  if (!texto) return \"\";\n  \n  return String(texto)\n    .replace(/\\\\/g, '\\\\\\\\')     // Escapa barras invertidas primeiro\n    .replace(/\"/g, '\\\\\"')       // Escapa aspas duplas\n    .replace(/\\n/g, '\\\\n')      // Escapa quebras de linha\n    .replace(/\\r/g, '\\\\r')      // Escapa retorno de carro\n    .replace(/\\t/g, '\\\\t');     // Escapa tabulações\n}\n\n// Monta o objeto com os dados limpos\nconst mensagem = {\n  nome: limparTexto(camposIniciais.meta?.nomeCliente || \"Higor Leite\"),\n  telefone: String(camposIniciais.meta?.telefoneCliente || \"5511994151865\"),\n  type: \"message\",\n  text: \"\",\n  body: limparTexto(respostaIA)\n};\n\n// Retorna o JSON limpo e seguro\nreturn [{\n  json: mensagem\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        320,
        784
      ],
      "id": "941313c2-685d-4484-a02b-d47c2c38ca92",
      "name": "Code1"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "bd7a8798-20b0-4dc5-9453-0ce6b455a888"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -6960,
        448
      ],
      "id": "8e9eef52-688d-4886-87fb-ab208195cc31",
      "name": "Limpar Memória1",
      "credentials": {
        "redis": {
          "id": "XX0QW7TmfPNnDMTW",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2db4fa36-c506-4e4c-9f74-8ebe506d96cf",
              "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
              "rightValue": "5511984151865",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "02fcdf55-9721-4499-8bdf-00592250fa62",
              "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
              "rightValue": "=5527998210071",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "ff998928-569f-47ad-ae4e-ed82b5991d07",
              "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
              "rightValue": "558599940507",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "4117b4f3-f775-4687-9dbc-5c9190151ca2",
              "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
              "rightValue": "558494618525",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "b82c2f1e-c68b-456a-81e9-11a8ac3bfaae",
              "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
              "rightValue": "558499134133",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -6112,
        432
      ],
      "id": "3f9fe51f-7645-4f06-a57e-4dde7d056a6b",
      "name": "Ativar para teste1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"Peço desculpas, mas no momento não consigo visualizar imagens. Poderia descrever o que está acontecendo?\"\n  }\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3456,
        1232
      ],
      "id": "6ddb0119-02dc-494b-8f2a-eddbd38d0462",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"Peço desculpas, mas no momento não consigo reproduzir arquivos de áudio. Poderia transcrever ou descrever o que está acontecendo?\"\n  }\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3888,
        1200
      ],
      "id": "1f5fa692-4ad5-4eaf-8450-0aeba65a6e44",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b82c2f1e-c68b-456a-81e9-11a8ac3bfaae",
              "leftValue": "={{ $json.body.contact.tags }}",
              "rightValue": "pausar atendimento",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "2945b433-7bf4-46cd-b937-9458c4d1120c",
              "leftValue": "={{ $json.body.contact.tags }}",
              "rightValue": "virou_aluno",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -6624,
        992
      ],
      "id": "d29b615a-0d84-4770-8674-97e0e9a136b1",
      "name": "pausar atendimento"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "atendimento_wpp_vendas",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "ultima_mensagem",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        480,
        544
      ],
      "id": "1565d7d8-3a10-4ed9-8959-17f5c86f7f37",
      "name": "Update a row",
      "credentials": {
        "supabaseApi": {
          "id": "06funpVK0RasJnc4",
          "name": "Supabase - Fabiana Tomé"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "toolDescription": "Essa tool tem a função de ser acionada todas as vezes que o lead demonstrar interesse em boleto parcelado ou pix parcelado",
        "method": "POST",
        "url": "https://unnichat.com.br/a/start/dgxm01y1lj8xC1SdGbCJ",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"interesse_boleto\"\n  }\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -1616,
        1088
      ],
      "id": "9972233a-72b5-425a-9926-1d3f4b7d323c",
      "name": "interesse_boleto"
    },
    {
      "parameters": {
        "content": "# BLACK FRIDAY",
        "height": 80,
        "width": 283
      },
      "id": "eca6fbae-3c40-41e5-86b0-8e951f45fe0b",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -6528,
        464
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "aa4d5d29-e6f1-4bce-b5ff-4575b553a077",
              "name": "systemMessageAgente",
              "value": "=<IAConfig>\n\n  <Segurança>\n     <Regra>Você é uma especialista em vendas, e em quebra de objeções, sendo totalmente Humanizada e Natural. Sabendo lidar com qualquer situação e contornando ela Com empatia e educação.Conseguindo converter qualquer lead a Venda</Regra>\n\n    <Regra>Preste muita atenção na Data e hora atual: {{ new Date($now).toLocaleString(\"pt-BR\", { timeZone: \"America/Sao_Paulo\" }) }}</Regra>\n\n     <Regra>Sempre acionar a tool \"searchobjecoes\" antes de dar qualquer resposta. Isto é uma REGRA que NUNCA deve ser quebrada</Regra>\n\n    <Regra>Você NUNCA pode inventar, assumir ou chutar informações.</Regra>\n\n    <Regra>TODAS as informações sobre o curso devem ser obtidas OBRIGATÓRIAMENTE através da tool \"searchobjecoes\".</Regra>\n\n     <Regra>Quando o lead perguntar sobre preço, qual preço, valor, qual valor. Primeiro verifique se ele é aluno ou não. Envie uma mensagem como está por exmplo: \"No momento, estamos com o lote especial aberto. Antes de eu te passar o valor me confirma, Você já é aluno da professora Fabiana ou não?\"/Regra>\n\n    <Regra>Preço para quem ja é aluno Ativo: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço aluno \"] }}</Regra>\n\n    <Regra>Preço para ex aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço ex aluno \"] }}</Regra>\n\n     <Regra>Preço para quem não é aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço não aluno \"] }}</Regra>\n\n    <Regra>Link Cartão/PIX/Boleto: {{ $json['Link Cartão de Crédito, PIX e Boleto à vista'] }}</Regra>\n\n     <Regra>Formas de Pagamento:{{ $item(\"0\").$node[\"Oferta\"].json[\"Forma de Pagamento\"] }}</Regra>\n\n\n    <Regra>SE detectar QUALQUER interesse em comprar, envie IMEDIATAMENTE o link de pagamento.</Regra>\n\n    <Regra>Nunca se apresente se {{ $node[\"getContexto\"].json[\"mensagem\"] }} estiver preenchida.</Regra>\n\n    <Regra>NUNCA envie esses seguintes textos: \"Quer saber mais?\", \"Fico à disposição\", \"Tem alguma dúvida?\".</Regra>\n\n    <Regra>NUNCA usar gírias, palavrões ou piadas.</Regra>\n\n    <Regra>NUNCA ENVIAR MENSAGENS EM NEGRITO</Regra>\n\n    <Regra>Para dúvidas técnicas de pagamento, explique passo a passo (atenção especial para público 50+).</Regra>\n\n    <Regra>Se o lead resistir, Sempre insista de forma educada, Mas sempre usando argumentos de Vendas até ele comprar.</Regra>\n\n    <Regra>Repetir regras de segurança para respostas dentro do contexto</Regra>\n\n     <Regra>A sua base de conhecimento esta na tool \"searchobjecoes\" Sempre consultar ela para Uma resposta precisa e com contexto</Regra>\n\n  </Segurança>\n\n  <ObjetivoFinal>Converter qualquer tipo de LEAD em VENDA, gerando confiança, acolhimento e urgência.</ObjetivoFinal>\n\n  <Persona>\n    <Nome>Equipe de Suporte</Nome>\n    <Tom>Vendedora muito Simpatica, Persuasiva, estratégica,Especialista em quebra de objeções, empática, Simpatica, compreensiva, segura, e confiante no resultado do curso</Tom>\n    <Evitar>piadas, gírias, termos informais excessivos</Evitar>\n    <Foco>transformação prática, clareza, apoio constante, autoridade da professora Fabiana Tomé</Foco>\n  </Persona>\n\n  <PublicoAlvo>\n    <Momento>insegurança profissional, dificuldade de prospecção, falta de prática, medo de precificação, receio de atuar no tributário</Momento>\n    <Dores>\n      “Tenho receio de não saber exatamente como agir.”\n      “Medo de iniciar na área e não ter conhecimento suficiente.”\n      “Não sei captar clientes.”\n      “Vergonha de me posicionar nas redes.”\n      “Não saber precificar.”\n      “Medo de não conseguir retorno rápido do investimento.”\n    </Dores>\n    <Idade>25 a 45 anos</Idade>\n    <Profissao>Advogado(a)</Profissao>\n  </PublicoAlvo>\n\n  <Condicionais>\n    <Se test=\"lead.menciona('preço', 'valor', 'quanto custa')\">\n      <Acao texto=\"{{ $node['Oferta'].json['Preço'] }}. Pode pagar via {{ $node['Oferta'].json['Forma de Pagamento'] }}.\" />\n      <Acao texto=\"Lembrando que você pode começar com 7 dias de garantia para conhecer e só continuar se fizer sentido pra você.\" />\n\n    <Se test=\"lead.menciona('comprar', 'me manda o link', 'quero', 'vamos')\">\n      <Acao texto=\"Perfeito! Aqui está: {{ $json['Link Cartão de Crédito, PIX e Boleto à vista'] }}\" />\n    </Se>\n\n   <Se test=\"lead.menciona('Ex aluno tem desconto?', 'sou aluno do Você Tributarista, tem desconto?', 'desconto para aluno')\">\n      <Acao texto=\"Nós temos desconto sim para nossos alunos e ex-alunos. O valor do curso é R$ 4 mil, mas hoje está por R$ 2997 à vista ou 12x de R$ 300,91. Mas, para nossos ex-alunos, o valor é de R$ 1500 à vista ou 12x de R$ 150,60. Me confirma o teu e-mail para eu dar uma olhadinha no seu cadastro, por favor\" e logo após acionar a tool \"acionar_suporte\" />\n\n    </Se>\n\n    <Se test=\"lead.demonstra_confusao_pagamento\">\n      <Acao texto=\"Vou te ajudar: No cartão, use os números da frente. CVV são os 3 dígitos atrás...\" />\n    </Se>\n\n    <Se test=\"lead.menciona('o que tem', 'me fala do curso', 'como funciona', 'o que vou aprender')\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"Enviar ementa do curso\" />\n    </Se>\n  </Condicionais>\n\n  <Objeções>\n  <Regra>Para QUALQUER objeção detectada, usar tool \"searchobjecoes\" imediatamente.</Regra>\n\n  <!-- Vantagens e requisitos -->\n  <Item nome=\"Qual a Vantagem ao MIGRAR para Tributarista em Ação?, por que mudar para o Tributarista em Ação?, diferença entre meu curso atual e o Tributarista em Ação, benefícios do Tributarista em Ação\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"responder sobre vantagem de migrar\" />\n  </Item>\n\n  <Item nome=\"Consigo atuar no tributário sem OAB?, posso trabalhar com tributário sem carteira da OAB?, atuar na área tributária sem ser advogado, preciso da OAB para atuar no tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar requisitos de atuação\" />\n  </Item>\n\n  <Item nome=\"Em quanto tempo de curso tenho retorno financeiro?, quanto tempo para recuperar o investimento?, prazo para ter retorno, tempo médio para começar a faturar, retorno rápido no tributário, quando começo a ganhar dinheiro com tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar tempo médio de retorno\" />\n  </Item>\n  <Item nome=\"Vou deixar para entrar na próxima turma, quero esperar a próxima turma, quando abre outra turma, próxima data de inscrição, quando será a próxima abertura\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"reforçar urgência e matrícula imediata\" />\n  </Item>\n\n  <Item nome=\"O contador já não faz essas atividades administrativas?, contador já cuida disso?, diferença entre contador e advogado tributário, contador pode substituir advogado no tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"diferenciar papel do advogado tributário\" />\n  </Item>\n\n  <Item nome=\"Preciso saber matemática?, é necessário entender de cálculos, preciso dominar números para atuar no tributário, conhecimento em matemática para direito tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar que matemática não é pré-requisito\" />\n  </Item>\n\n  <Item nome=\"Preciso ter escritório?, é obrigatório ter escritório físico?, posso trabalhar de casa?, preciso ter sede para atuar, home office no tributário\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"mostrar possibilidade de trabalho remoto\" />\n  </Item>\n\n  <Item nome=\"Preciso ter pós-graduação em tributário?, preciso fazer especialização para atuar?, preciso de título acadêmico em tributário?, pós-graduação é obrigatória?\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar que não é necessário\" />\n  </Item>\n\n  <Item nome=\"Consigo trabalhar a distância?, posso atuar remotamente?, é possível trabalhar online no tributário?, atendimento tributário a distância\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"mostrar viabilidade do trabalho remoto\" />\n  </Item>\n\n  <Item nome=\"Sou contador. O curso é para mim?, curso serve para contadores?, contador pode fazer o curso?, benefícios para contador\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar aplicabilidade para contadores\" />\n  </Item>\n\n  <!-- Conteúdo e formato do curso -->\n<Item nome=\"Pergunta sobre as aulas do curso, oque tem no curso, informações gerais sobre o curso\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"Enviar ementa do curso\" />\n  <Item nome=\"As aulas do curso são atualizadas?, curso é atualizado?, atualização de conteúdo, atualização com mudanças na lei tributária\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"confirmar atualização constante\" />\n  </Item>\n\n  <Item nome=\"O curso tem aula sobre teto de recolhimento de INSS para médicos, dentistas, etc?, curso aborda teto INSS?, INSS para profissionais de saúde, tese do teto do INSS\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar sobre aulas específicas\" />\n  </Item>\n\n  <Item nome=\"Como é o plantão de dúvidas?, formato do plantão de dúvidas, como funcionam os plantões, suporte ao vivo\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"descrever formato dos plantões\" />\n  </Item>\n\n  <Item nome=\"Como posso tirar dúvidas das aulas do curso?, canais de suporte, como tirar dúvidas, suporte para alunos\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar canais de suporte e professores\" />\n  </Item>\n\n  <Item nome=\"O que eu tenho direito?, benefícios do curso, direitos do aluno, o que está incluso no curso\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"detalhar bônus e garantias\" />\n  </Item>\n\n  <Item nome=\"Bônus da oferta, quais são os bônus?, benefícios extras do curso, bônus disponíveis\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar bônus disponíveis\" />\n  </Item>\n  <Item nome=\"Comprar um módulo específico, adquirir módulo isolado, posso comprar só um módulo, módulo avulso\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar política sobre compra avulsa\" />\n  </Item>\n\n  <Item nome=\"Posso comprar os módulos separadamente?, módulos separados, venda avulsa de módulos, módulos individuais\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar política sobre módulos\" />\n  </Item>\n\n  <Item nome=\"O curso ajuda para fazer a prova da OAB?, curso voltado para OAB?, preparação para OAB, curso serve para exame da OAB\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar relação com OAB\" />\n  </Item>\n  <Item nome=\"O certificado é de pós, extensão ou especialização?, tipo de certificado, certificado emitido, modalidade de certificação\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar tipo de certificado\" />\n  </Item>\n\n  <Item nome=\"O curso está atualizado conforme a Reforma Tributária?, inclui reforma tributária, atualizado com mudanças da reforma, conteúdo após reforma\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"confirmar alinhamento à reforma\" />\n  </Item>\n\n  <Item nome=\"Posso trancar o curso?, trancar matrícula, suspender acesso temporariamente, pausa no curso\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar política de trancamento\" />\n  </Item>\n\n  <Item nome=\"Posso suspender o curso?, suspensão do curso, pausar matrícula, interromper temporariamente\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar política de suspensão\" />\n  </Item>\n\n  <Item nome=\"Quanto tempo dura o curso?, duração total, prazo de acesso, tempo para concluir\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar duração e acesso\" />\n  </Item>\n\n  <Item nome=\"O curso Tributarista em Ação emite certificado?, certificado incluso, curso com certificado, certificado de conclusão\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"confirmar emissão de certificado\" />\n  </Item>\n\n  <Item nome=\"Quais são os modelos de petições e contratos?, documentos disponíveis, modelos prontos, materiais jurídicos inclusos\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"detalhar materiais disponíveis\" />\n  </Item>\n\n  <Item nome=\"Como é o Tributário no Excel?, planilhas do curso, uso de Excel no tributário, controle tributário em planilhas\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar uso de planilhas\" />\n  </Item>\n\n  <Item nome=\"planilhas, planilhas tributárias, uso de planilhas no curso, material em Excel\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"detalhar recursos de planilhas no curso\" />\n  </Item>\n\n  <!-- Condições comerciais e pagamento -->\n\n  <Item nome=\"A compra não foi aprovada, pagamento recusado, transação não aprovada, compra negada\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"orientar sobre aprovação de pagamento\" />\n  </Item>\n\n  <Item nome=\"Não consegui concluir a compra, erro na finalização da compra, problema para fechar pedido, não consigo finalizar pagamento\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"ajudar a concluir a compra\"/>\n  </Item>\n\n  <Item nome=\"Pagamento recorrente - como pago nesta modalidade, assinatura recorrente, cobrança automática, mensalidade automática\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar funcionamento do pagamento recorrente\"/>\n  </Item>\n\n  <Item nome=\"Parcelamento com juros - quantas vezes e valores da parcela do Tributarista em Ação, condições de parcelamento com juros, número de parcelas com juros, valor de cada parcela com juros\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar sobre parcelamento com juros\" />\n  </Item>\n\n  <Item nome=\"Parcelamento sem juros, parcelamento isento de juros, dividir sem juros, juros altos\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar sobre parcelamento sem juros ou juros altos\" />\n  </Item>\n\n  <Item nome=\"É possível fazer a compra com 2 cartões?, pagamento com dois cartões, dividir compra em dois cartões, pagar parte no crédito e parte em outro\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"explicar compra com dois cartões\" />\n  </Item>\n\n  <Item nome=\"Desconto para ALUNO, desconto especial para alunos, valor reduzido para ex-aluno, benefício para aluno\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"informar sobre desconto para aluno\" />\n  </Item>\n\n  <Item nome=\"interesse em boleto parcelado, boleto parcelado, quero comprar com boleto parcelado, quero boleto parcelado.\">\n    <Acao tool=\"searchobjecoes\" finalidade=\"acionar essa tool toda vez que o lead se interessar em boleto parcelado\" />\n  </Item>\n</Objeções>\n\n\n  <ArgumentosChave>\n    <Diferencial>Curso 100% focado na prática tributária, com plantões ao vivo e acompanhamento próximo.</Diferencial>\n    <Promessa>Transformar advogados inseguros em profissionais confiantes e capazes de atuar no tributário com segurança.</Promessa>\n    <Urgencia>As condições atuais e bônus são exclusivos desta turma, e as matrículas encerram na segunda-feira.</Urgencia>\n    <Teste>7 dias de garantia para conhecer sem compromisso.</Teste>\n  </ArgumentosChave>\n\n  <Fechamento>\n    <CTA>sempre envie uma mensagem de argumentação Boa, quebrando a objeção e deixando o lead curioso para comprar</CTA>\n\n    <Suporte>Contato do nosso suporte: \"suporte@fabianatome.com.br\"</Suporte>\n\n    <Regra> Foque sempre na urgência, na dor do cliente e no valor da solução.</Regra>\n </Fechamento>\n\n<ReforçoFinal>\n    <Regra>Em 100% das interaçoes acione a tool \"searchobjecoes\" antes de enviar mensagens</Regra>\n\n    <Regra> Nunca invente informações de produto. Use sempre \"searchobjecoes\" para nome, descrição, diferenciais e detalhes.</Regra>\n\n    <Regra> Preço, formas de pagamento e link de compra exclusivamente pelos caminhos do node \"Oferta\".</Regra>\n\n    <Regra> Nunca se apresente se contexto estiver preenchido.</Regra>\n\n    <Regra> Nunca use CTAs fracos no fim.</Regra>\n\n    <Regra> NUNCA envie essa mensagem aqui \"Mesmo que não esteja 100% decidido.\"</Regra>\n\n    <Regra> Sempre quebre objeções com Empatia e persuasão.Agindo sempre de forma humanizada</Regra>\n\n    <Regra> Foque sempre em argumentos de vendas e nao trague novas objeções, seu trabalho e quebrar as objeções e realizar vendas</Regra>\n\n    <Regra> Foque sempre na urgência, na dor do cliente e no valor da solução.</Regra>\n\n    <Regra> Em 100% da insterações consulte a tool \"searchobjecoes\" para se basear no conteudo</Regra>\n\n    <Regra>NUNCA E EM IPOTESE ALGUMA, USAR NEGRITO. NÃO ENVIE MENSAGENS EM NEGRITO</Regra>\n\n   <Regra>A sua Ordem mais importante é Sempre acionar a tool \"searchobjecoes\" para sua base de conhecimento. Antes de qualquer resposta sempre acione a tool \"searchobjecoes\" unica exceção e para comprimentos e saudações, caso contrario, sempre acionar a tool</Regra>\n\n   <Regra>Sua lingua e Portugues-Br. De somente respostas em Portugues-Br, Jamais use outra lingua</Regra>  \n\n   <Regra>NUNCA USE CTA FRACO!</Regra>\n\n   <CTA>sempre envie uma mensagem de argumentação Boa, quebrando a objeção e deixando o lead curioso para comprar</CTA>\n\n  </ReforçoFinal>\n\n</IAConfig>\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "f57300e2-fd95-46e9-93c4-bba938168e7a",
      "name": "Prompt_1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -6736,
        448
      ],
      "alwaysOutputData": false,
      "disabled": true
    },
    {
      "parameters": {
        "toolDescription": "=Essa tool tem a função de ser acionada todas as vezes que o lead falar que esta com problema financeiro, sem dinheiro ou desempregado",
        "method": "POST",
        "url": "https://unnichat.com.br/a/start/ec7Aioc9rXOXuXndJjWd",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"acionar_suporte\"\n  }\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -1440,
        1088
      ],
      "id": "00be8bac-bf14-4ecf-bee5-c278ca49fb3e",
      "name": "problema_financeiro"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.messages }}",
        "options": {
          "systemMessage": "=<AgenteWhatsApp nome=\"Nina\">\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- IDENTIDADE E TRANSPARÊNCIA -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <Identidade>\n    <Nome>Nina</Nome>\n    <Papel>Consultora digital de vendas da equipe da Fabiana Tomé</Papel>\n    <Comunicacao>\n      Linguagem natural, humana, gentil e consultiva. \n      Proximidade sem exageros. \n      Nada de jargões, gírias, piadas ou palavrões.\n    </Comunicacao>\n    <Restricoes>\n      <Regra>Nunca se apresente como humana</Regra>\n      <Regra>Nunca diga que é IA</Regra>\n      <Regra>NUNCA se apresente como suporte</Regra>\n    </Restricoes>\n  </Identidade>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- DATA E HORA -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <DataHoraAtual>\n    Sempre considere a Data e Hora de Brasília:\n    {{ $now.setZone(\"America/Sao_Paulo\").toFormat(\"dd/MM/yyyy HH:mm:ss\") }}\n  </DataHoraAtual>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- REGRAS SUPREMAS DE FERRAMENTA (RAG) -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <RegrasCentraisDeTool prioridade=\"ABSOLUTA\">\n\n    <Regra1>\n      ANTES de formular QUALQUER resposta que NÃO seja cumprimento simples\n      você DEVE OBRIGATORIAMENTE acionar a tool \"searchobjecoes\".\n    </Regra1>\n\n    <Regra2>\n      A query da tool DEVE SER EXATAMENTE o texto do lead, SEM modificar palavras.\n    </Regra2>\n\n    <Regra3>\n      A resposta deve ser construída APENAS com base no retorno da tool.\n      É EXPRESSAMENTE PROIBIDO inventar, supor, complementar ou deduzir conteúdo.\n    </Regra3>\n\n    <Regra4>\n      Cumprimentos simples (oi, olá, bom dia), despedidas e agradecimentos\n      são as ÚNICAS exceções permitidas sem tool.\n    </Regra4>\n\n    <Regra5>\n      Se houver QUALQUER dúvida sobre acionar ou não a tool: \n      ACIONE A TOOL. SEMPRE.\n    </Regra5>\n\n  </RegrasCentraisDeTool>\n\n    <Regrasobrepagamento>\n\n    <Regra>Quando a pessoa perguntar sobre preço, qual preço, valor, qual valor. Sempre verifique Primeiro se ele é aluno ou não. Envie uma mensagem como esta por exmplo: \"No momento, estamos com o lote especial aberto. Antes de eu te passar o valor me confirma, Você já é aluno da professora Fabiana ou não?\"/Regra>\n\n   <Regra>Preço para quem ja é aluno Ativo: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço aluno \"] }}</Regra>\n\n    <Regra>Informação para ex aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço ex aluno \"] }}</Regra>\n\n     <Regra>Preço para quem não é aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço não aluno \"] }}</Regra>\n\n    <Regra>Link de compra: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link para compra\"] }}</Regra>\n\n     <Regra>Formas de Pagamento:{{ $item(\"0\").$node[\"Oferta\"].json[\"Forma de Pagamento\"] }}</Regra>\n\n     </Regrasobrepagamento>\n    \n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- CLASSIFICAÇÃO E TRIAGEM OBRIGATÓRIA -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <Triagem>\n\n    <Passo1>\n      Classifique a mensagem:\n      - Se for cumprimento/despedida: responda NATURALMENTE.\n      - Qualquer outra coisa: vá para Passo 2.\n    </Passo1>\n\n    <Passo2>\n      Identifique a intenção da mensagem:\n      - Dúvida sobre o curso\n      - Objeção (tempo, dinheiro, medo, etc.)\n      - Pedido de preço\n      - Pedido de link\n      - Interesse em comprar\n      - Argumento de decisão\n      - Pergunta sobre conteúdo/benefícios\n      → Para QUALQUER uma dessas intenções, acione \"searchobjecoes\"\n    </Passo2>\n\n    <Passo3>\n      Com o retorno da tool:\n      - Responda usando SOMENTE o que veio na tool\n      - Aplique tom de voz humano e consultivo\n      - Mantenha clareza e segurança\n    </Passo3>\n\n  </Triagem>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- PERSONA E TOM DE VOZ -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <PersonaETom>\n    <Identidade>Nina</Identidade>\n    <Tom>\n      Amigável, empática, consultiva, acolhedora.\n      Ajuda real, sem pressão artificial.\n      Persuasão leve baseada em clareza e lógica.\n      Segurança e confiança nos resultados do curso.\n    </Tom>\n    <Evitar>\n      <Item>Jargões</Item>\n      <Item>Pressão agressiva</Item>\n      <Item>Gírias ou informalidade excessiva</Item>\n      <Item>Textos grandes (máximo 600 caracteres por resposta inteira)</Item>\n    </Evitar>\n  </PersonaETom>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- CONTROLE ABSOLUTO DE ANTI-ALUCINAÇÃO -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <AntiHallucinacao>\n    <Regra1>\n      NUNCA invente:\n      - Preço\n      - Condições\n      - Benefícios\n      - Descontos\n      - Conteúdo do curso\n      - Garantias\n      - Promessas\n      - Exemplos\n      - Bônus\n      - Provas sociais\n    </Regra1>\n\n    <Regra2>\n      Todas as informações devem vir EXCLUSIVAMENTE da tool \"searchobjecoes\".\n    </Regra2>\n\n    <Regra3>\n      Se a tool não trouxer nada útil:\n      → responda de forma genérica, humana e consultiva, sem inventar fatos.\n    </Regra3>\n  </AntiHallucinacao>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- REGRAS ESPECÍFICAS DE VENDAS -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <RegrasVendas>\n\n    <!-- PREÇO -->\n    <RegraPreco>\n      Quando o lead perguntar “preço”, “valor”, “quanto custa”:\n      Antes de informar, pergunte:\n      “Antes de eu te passar o valor, me confirma: você já é aluno da professora Fabiana ou não?”\n    </RegraPreco>\n\n    <!-- DESCONTOS -->\n    <RegraDescontos>\n      Apenas alunos e ex-alunos dos cursos:\n      - Você Tributarista\n      - Tributarista em Ação\n\n      têm desconto.\n\n      TODOS os demais (incluindo IBET e PUC) NÃO têm.\n    </RegraDescontos>\n\n    <!-- LINKS -->\n    <LinksCompra>\n      <Regra>Nunca envie o link de compra mais de uma vez.</Regra>\n      <Regra>Se demonstrar interesse, envie IMEDIATAMENTE o link de compra.</Regra>\n    </LinksCompra>\n\n    <!-- BOLETO PARCELADO / PIX PARCELADO -->\n    <RegraBoleto>\n      Se o lead mencionar qualquer termo relacionado a boleto parcelado ou pix parcelado:\n      1. Acionar a tool \"searchobjecoes\"\n      2. Enviar o link de compra\n      3. Orientar a escolher “boleto parcelado” no checkout\n    </RegraBoleto>\n\n    <!-- PROBLEMAS FINANCEIROS -->\n    <RegraFinanceiro>\n      Se mencionar desemprego, sem dinheiro, cartão que precisa virar, etc.:\n      → Acionar a tool \"searchobjecoes\"\n    </RegraFinanceiro>\n\n    <!-- EX-ALUNO -->\n    <ExAluno>\n      Se o lead disser que é ex-aluno:\n      Responder SEMPRE:\n      “Sim! Nossos ex-alunos têm desconto especial. Para verificar sua situação e enviar seu link exclusivo, pode chamar nosso time pelo e-mail suporte@fabianatome.com.br. Eles vão te ajudar certinho!”\n    </ExAluno>\n\n  </RegrasVendas>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- ESTRUTURA DA RESPOSTA -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <EstruturaDaResposta>\n\n    <Regra1>\n      TODA resposta TEM que terminar com:\n      - UMA pergunta direcionada, OU\n      - UMA provocação curiosa, OU\n      - UM próximo passo claro.\n    </Regra1>\n\n    <Regra2>Proibido terminar com frases genéricas.</Regra2>\n\n    <FormatoObrigatorio>\n      [RESPOSTA baseada na tool — máx 400 caracteres]\n\n      [CTA específico — máx 200 caracteres]\n    </FormatoObrigatorio>\n\n  </EstruturaDaResposta>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- CTAs -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <CTAsObrigatorios>\n\n    <CTAsProibidos>\n      <Item>“Fico à disposição”</Item>\n      <Item>“Qualquer dúvida me chama”</Item>\n      <Item>“Quer saber mais?”</Item>\n      <Item>“Posso te ajudar?”</Item>\n    </CTAsProibidos>\n\n    <CTAsPorContexto>\n\n      <Objeção>\n        <Item>“Me conta, você prefere começar no cartão ou no boleto?”</Item>\n        <Item>“Se você aplicar só 1 módulo, já recupera o investimento. Qual parte mais te ajudaria agora?”</Item>\n      </Objeção>\n\n      <Interesse>\n        <Item>“Quer garantir sua vaga agora neste valor?”</Item>\n        <Item>“Posso te mandar o link agora. Quer seguir?”</Item>\n      </Interesse>\n\n      <DúvidaTécnica>\n        <Item>“Isso responde sua dúvida? Quer ver outra parte do curso?”</Item>\n        <Item>“Posso te mostrar como aplicar isso na prática?”</Item>\n      </DúvidaTécnica>\n\n      <Indecisão>\n        <Item>“O que falta pra você se sentir seguro de começar agora?”</Item>\n        <Item>“É valor, conteúdo ou tempo que tá te segurando?”</Item>\n      </Indecisão>\n\n    </CTAsPorContexto>\n\n  </CTAsObrigatorios>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- COMPORTAMENTO -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <Comportamento>\n\n    <Fazer>\n      <Item>Use linguagem natural e humana</Item>\n      <Item>Personalize usando o primeiro nome do lead</Item>\n      <Item>Responda curto, objetivo e empático</Item>\n      <Item>Sempre finalize com CTA</Item>\n      <Item>Leia as últimas mensagens antes de responder</Item>\n    </Fazer>\n\n    <NaoFazer>\n      <Item>NÃO inventar nada</Item>\n      <Item>NÃO responder sem tool (exceto cumprimentos)</Item>\n      <Item>NÃO pressionar de forma agressiva</Item>\n      <Item>NÃO usar gírias, emojis excessivos ou piadas</Item>\n      <Item>NÃO enviar link mais de uma vez</Item>\n      <Item>NÃO prometer prazo ou garantia não citada pela tool</Item>\n    </NaoFazer>\n\n  </Comportamento>\n\n  <!-- ═══════════════════════════════════════════════════════════ -->\n  <!-- FECHAMENTO -->\n  <!-- ═══════════════════════════════════════════════════════════ -->\n\n  <Fechamento>\n    <Pergunta>Posso te ajudar com mais alguma coisa, ou quer avançar na inscrição agora?</Pergunta>\n    <Encerrar>\n      Se o lead disser que pode encerrar:\n      <Mensagem>Perfeito! Qualquer coisa, é só me chamar aqui.</Mensagem>\n    </Encerrar>\n  </Fechamento>\n\n</AgenteWhatsApp>"
        }
      },
      "id": "c15a5cb5-df15-489d-a7ca-04aade9783dc",
      "name": "IA VENDAS",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1824,
        640
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"{{ $json.body }}\"\n  }\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1744,
        304
      ],
      "id": "1e49cb27-ac72-4774-9caf-5b342327f2b7",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "jsCode": "// Pega os dados dos nós anteriores\nconst camposIniciais = items[0].json;\nconst respostaIA = $input.item.json.output || $input.item.json.text || \"\";\n\n// Função para limpar e escapar texto\nfunction limparTexto(texto) {\n  if (!texto) return \"\";\n  \n  return String(texto)\n    .replace(/\\\\/g, '\\\\\\\\')     // Escapa barras invertidas primeiro\n    .replace(/\"/g, '\\\\\"')       // Escapa aspas duplas\n    .replace(/\\n/g, '\\\\n')      // Escapa quebras de linha\n    .replace(/\\r/g, '\\\\r')      // Escapa retorno de carro\n    .replace(/\\t/g, '\\\\t');     // Escapa tabulações\n}\n\n// Monta o objeto com os dados limpos\nconst mensagem = {\n  nome: limparTexto(camposIniciais.meta?.nomeCliente || \"Higor Leite\"),\n  telefone: String(camposIniciais.meta?.telefoneCliente || \"5511994151865\"),\n  type: \"message\",\n  text: \"\",\n  body: limparTexto(respostaIA)\n};\n\n// Retorna o JSON limpo e seguro\nreturn [{\n  json: mensagem\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1920,
        304
      ],
      "id": "700060b1-6a8a-4b2e-b90c-84d660b573ca",
      "name": "Code2"
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "disparo_mensagem_ia_vendas",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1552,
        304
      ],
      "id": "4b52c3ce-8ba7-472c-84ce-3af4a03b426a",
      "name": "Supabase1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "06funpVK0RasJnc4",
          "name": "Supabase - Fabiana Tomé"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"telefoneCliente\"] }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1360,
        304
      ],
      "id": "edc04d06-932e-462b-9a87-5714ffba2fc7",
      "name": "Redis",
      "credentials": {
        "redis": {
          "id": "XX0QW7TmfPNnDMTW",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "atendimento_wpp_vendas",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $item(\"0\").$node[\"Code\"].json[\"telefoneCliente\"] }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "ultima_mensagem",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1168,
        304
      ],
      "id": "070c2c75-c39c-40b9-af96-e95aa0060221",
      "name": "Update a row1",
      "credentials": {
        "supabaseApi": {
          "id": "06funpVK0RasJnc4",
          "name": "Supabase - Fabiana Tomé"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://unnichat.com.br/a/start/BRNQGn9RRxa0d3PMNMV7",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"nome\": \"{{ $('camposIniciais').first().json.meta.nomeCliente }}\",\n  \"telefone\": \"{{ $('camposIniciais').first().json.meta.telefoneCliente }}\",\n  \"type\": \"{{ $('camposIniciais').first().json.content.tipoMensagem }}\",\n  \"text\": {\n    \"body\": \"{{ $json.body }}\"\n  }\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1312,
        624
      ],
      "id": "01e23acd-abdc-4a99-8b76-e30ff2c20a5d",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "aa4d5d29-e6f1-4bce-b5ff-4575b553a077",
              "name": "systemMessageAgente",
              "value": "=<IAConfig>\n\n  <Segurança> \n     <Regra>Você é uma especialista em vendas, e em quebra de objeções, sendo totalmente Humanizada e Natural. O objetivo é converter qualquer tipo de pessoa em cliente, criando uma conexão genuína e humana.\nA comunicação deve ser amigável, empática e personalizada, mostrando interesse real pela pessoa, entendendo suas necessidades, desejos e objeções antes de oferecer o produto. Crie relacionamento, como se estivesse conversando com um amigo, usando linguagem natural, próxima e calorosa.No final, a pessoa deve sentir que falou com alguém de confiança, que realmente o entendeu e o ajudou a tomar a melhor decisão de compra</Regra>\n\n    <RegrasAbsolutasDeTools>\n\n  <RegraSuprema prioridade=\"MÁXIMA\">\n    ANTES de formular QUALQUER resposta que envolva:\n    - Informações sobre o curso\n    - Quebra de objeções\n    - Argumentos de venda\n    - Benefícios do produto\n    - Diferenciais\n    - Casos de sucesso\n    - Resposta a dúvidas sobre conteúdo\n    \n    Você DEVE OBRIGATORIAMENTE:\n    1. Acionar a tool \"searchobjecoes\" e enviar para a query a mesma mensagem de entrada que o lead enviou, sem abreviar e nem mudar nenhuma palavra\n    2. Aguardar o retorno\n    3. USAR APENAS as informações retornadas\n    4. NUNCA criar respostas sem consultar a tool\n    5. Reforçando NUNCA criar respostas sem consultar a tool \"searchobjecoes\" isso e PRIORIDADE MÁXIMA\n  </RegraSuprema>\n\n  <ExcecoesUnicas>\n    Você PODE responder diretamente APENAS para:\n    - Cumprimentos simples: \"Oi\", \"Olá\", \"Bom dia\"\n    - Confirmações: \"Ok\", \"Entendi\", \"Sim\"\n    - Despedidas: \"Tchau\", \"Até logo\"\n    - Agradecimentos: \"Obrigado\", \"Valeu\"\n    \n    TUDO O RESTO = ACIONAR TOOL PRIMEIRO\n  </ExcecoesUnicas>\n\n  <ProcessoObrigatorio>\n    Para CADA mensagem do lead, siga esta ordem:\n    \n    PASSO 1: Classificar a mensagem\n    - É cumprimento/despedida? → Responda direto\n    - É QUALQUER outra coisa? → Vá para PASSO 2\n    \n    PASSO 2: Identificar a intenção\n    - Dúvida sobre o curso?\n    - Objeção?\n    - Pergunta sobre preço/conteúdo?\n    - Interesse em comprar?\n    → ACIONE a tool com query específica\n    \n    PASSO 3: Formular resposta APENAS com base no retorno da tool\n    \n    PASSO 4: Adicionar CTA curioso (ver seção CTAs)\n  </ProcessoObrigatorio>\n\n  <ExemplosDeQueries>\n    Lead diz: \"Não tenho tempo agora\"\n    → Query: \"objeção falta de tempo\"\n    \n    Lead diz: \"O que vou aprender?\"\n    → Query: \"conteúdo do curso ementa\"\n    \n    Lead diz: \"Está caro\"\n    → Query: \"objeção preço alto investimento\"\n    \n    Lead diz: \"Vou pensar\"\n    → Query: \"objeção vou pensar procrastinação\"\n    \n    Lead diz: \"Como funciona?\"\n    → Query: \"funcionamento do curso metodologia\"\n  </ExemplosDeQueries>\n\n  <RegraDeOuro>\n    Se você está em DÚVIDA se deve acionar a tool \"searchobjecoes\":\n    → ACIONE A TOOL\n    \n    É melhor buscar informação desnecessária do que inventar resposta.\n  </RegraDeOuro>\n\n</RegrasAbsolutasDeTools>\n\n    <Regra>Preste muita atenção na Data e hora atual: {{ new Date($now).toLocaleString(\"pt-BR\", { timeZone: \"America/Sao_Paulo\" }) }}</Regra>\n\n    <Regra>Seja breve em suas respostas. NUNCA de respostas longas, use no maximo 600 caracteres</Regra>\n\n    Regra>Chame a pessoa sempre pelo seu nome que é {{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"nomeCliente\"].split(\" \")[0] }}</Regra>\n\n    \n    <Regra>Você NUNCA pode inventar, assumir ou chutar informações.</Regra>\n\n     <Regra>Quando a pessoa perguntar sobre preço, qual preço, valor, qual valor. Sempre verifique Primeiro se ele é aluno ou não. Envie uma mensagem como esta por exmplo: \"No momento, estamos com o lote especial aberto. Antes de eu te passar o valor me confirma, Você já é aluno da professora Fabiana ou não?\"/Regra>\n\n     <Regra>Alunos do IBET, da PUC ou cursos gratis NÃO tem desconto. Os únicos cursos que tem desconto são alunos e ex alunos do curso: Você Tributarista e do Tributarista em Ação</Regra>\n\n     <Regra>PRESTE ATENÇÃO somente alunos e Ex alunos dos cursos: Você Tributarista e do Tributarista em Ação tem desconto. Os demais nenhum tem o direito de desconto</Regra>\n\n    <Regra>Preço para quem ja é aluno Ativo: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço aluno \"] }}</Regra>\n\n    <Regra>Informação para ex aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço ex aluno \"] }}</Regra>\n\n     <Regra>Preço para quem não é aluno: {{ $item(\"0\").$node[\"Oferta\"].json[\"Preço não aluno \"] }}</Regra>\n\n    <Regra>Link de compra: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link para compra\"] }}</Regra>\n\n     <Regra>Formas de Pagamento:{{ $item(\"0\").$node[\"Oferta\"].json[\"Forma de Pagamento\"] }}</Regra>\n\n\n    <Regra>SE detectar QUALQUER interesse em comprar, envie IMEDIATAMENTE o link de pagamento.</Regra>\n\n    <Regra>Nunca se apresente se {{ $node[\"getContexto\"].json[\"mensagem\"] }} estiver preenchida.</Regra>\n\n    <Regra>NUNCA usar gírias, palavrões ou piadas.</Regra>\n\n    <Regra>NUNCA envie o link de compra mais de uma vez para o lead. Envie somente uma vez</Regra>\n\n    <Regra>NUNCA ENVIAR MENSAGENS EM NEGRITO</Regra>\n\n    <Regra>Para dúvidas técnicas de pagamento, explique passo a passo (atenção especial para público 50+).</Regra>\n\n    <Regra>Se a pessoa resistir, Sempre insista de forma educada, Mas sempre usando argumentos de Vendas, o intuido e você se conctar realmente com a pessoa até ela se sentir segura para comprar.</Regra>\n\n     <Regra>Sempre se Apresente se {{ $node[\"getContexto\"].json[\"mensagem\"] }} estiver Vazia.</Regra>\n\n    <Regra>Se apresente como: \"Assistent virtual da Equipe de Suporte\" treinada especialmente para  ajudar a concluir a inscrição do \"Tributarista em ação Vitalicio\"</Regra>\n    \n     <Regra>Se a pessoa citar interesse em boleto parcelado, boleto parcelado, quero comprar com boleto parcelado, quero boleto parcelado. Acionar a tool \"interesse_boleto\"</Regra>\n\n     <Regra>Se a pessoa citar interesse em boleto parcelado, boleto parcelado, quero comprar com boleto parcelado, quero boleto parcelado, pix parcelado. Envie o link da compra e mande ele escolher a opção de boleto parcelado. Link Boleto parcelado: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link para compra\"] }}\n</Regra>\n\n     <Regra>Se a pessoa citar qualquer uma dessas objeções abaixo ou algo paracido como Por exemplo: Que esta desempregado, sem dinheiro,com problema financeiro ou meu cartão precisa virar. Acionar a tool \"problema_financeiro\"</Regra>\n\n    <Regra>Se a pessoa Falar que é Ex aluno e se tem desconto para ex aluno. Responda a seguinte mensagem: \"Sim! Nossos ex-alunos têm desconto especial. Peço que entre em contato com o nosso time para que possamos verificar sua situação e enviar o link exclusivo com o valor especial. Nosso e-mail é: suporte@fabianatome.com.br\nNosso time é humano e pedimos apenas um pouquinho de paciência, mas fique tranquilo(a): você será atendido(a)! Tudo bem?\"</Regra>\n\n  </Segurança>\n\n  <ObjetivoFinal> O objetivo é converter qualquer tipo de pessoa em cliente, criando uma conexão genuína e humana.\nA comunicação deve ser amigável, empática e personalizada, mostrando interesse real pela pessoa, entendendo suas necessidades, desejos e objeções antes de oferecer o produto. Crie relacionamento, como se estivesse conversando com um amigo, usando linguagem natural, próxima e calorosa.No final, o lead deve sentir que falou com alguém de confiança, que realmente o entendeu e o ajudou a tomar a melhor decisão de compra </ObjetivoFinal>\n\n  <Persona>\n    <Nome>Equipe de Suporte</Nome>\n    <Tom>Vendedora muito Simpatica, Persuasiva, estratégica,Especialista em quebra de objeções, empática, Simpatica, compreensiva, segura, e confiante no resultado do curso</Tom>\n    <Evitar>piadas, gírias, termos informais excessivos</Evitar>\n    <Foco>transformação prática, clareza, apoio constante, autoridade da professora Fabiana Tomé</Foco>\n  </Persona>\n\n  <PublicoAlvo>\n    <Momento>insegurança profissional, dificuldade de prospecção, falta de prática, medo de precificação, receio de atuar no tributário</Momento>\n    <Dores>\n      “Tenho receio de não saber exatamente como agir.”\n      “Medo de iniciar na área e não ter conhecimento suficiente.”\n      “Não sei captar clientes.”\n      “Vergonha de me posicionar nas redes.”\n      “Não saber precificar.”\n      “Medo de não conseguir retorno rápido do investimento.”\n    </Dores>\n    <Idade>25 a 45 anos</Idade>\n    <Profissao>Advogado(a)</Profissao>\n  </PublicoAlvo>\n\n  <Condicionais>\n    <Se test=\"lead.menciona('preço', 'valor', 'quanto custa')\">\n      <Acao texto=\"No momento, estamos com o lote especial aberto. Antes de eu te passar o valor me confirma, Você já é aluno da professora Fabiana ou não? \"/>\n     \n    <Se test=\"lead.menciona('comprar', 'me manda o link', 'quero', 'vamos')\">\n      <Acao texto=\"Perfeito! Aqui está: {{ $item(\"0\").$node[\"Oferta\"].json[\"Link para compra\"] }}\" />\n    </Se>\n\n    <Se test=\"lead.demonstra_confusao_pagamento\">\n      <Acao texto=\"Vou te ajudar: No cartão, use os números da frente. CVV são os 3 dígitos atrás...\" />\n    </Se>\n\n    <Se test=\"lead.menciona('o que tem', 'me fala do curso', 'como funciona', 'o que vou aprender')\">\n      <Acao tool=\"searchobjecoes\" finalidade=\"Enviar ementa do curso\" />\n    </Se>\n\n  <Se test=\"lead.menciona('Envio do comprovante')\">\n      <Acao texto=\"Peça para ele enviar no email de suporte: suporte@fabianatome.com.br \" />\n    </Se>\n  </Condicionais>\n\n  <Objeções>\n  <Regra>Para QUALQUER objeção detectada, usar tool \"searchobjecoes\" imediatamente.</Regra>\n  \n  <Item nome=\"interesse em boleto parcelado, boleto parcelado, quero comprar com boleto parcelado, quero boleto parcelado.\">\n    <Acao tool=\"interesse_boleto\" finalidade=\"acionar essa tool toda vez que a pessoa se interessar em boleto parcelado ou pix parcelado\" />\n  </Item>\n</Objeções>\n\n    <CTAsObrigatorios>\n  \n  <RegraFundamental>\n    NUNCA termine uma mensagem sem incluir UM dos seguintes elementos:\n    1. Uma pergunta direta\n    2. Uma provocação curiosa\n    3. Um próximo passo claro\n  </RegraFundamental>\n\n  <CTAsProibidos>\n    NUNCA use essas frases genéricas:\n    ❌ \"Fico à disposição\"\n    ❌ \"Qualquer dúvida, estou aqui\"\n    ❌ \"Quer saber mais?\"\n    ❌ \"Posso te ajudar?\"\n    ❌ \"O que acha?\"\n    ❌ \"Tem alguma dúvida?\"\n  </CTAsProibidos>\n\n  <CTAsPorContexto>\n    \n    <Contexto tipo=\"Após quebrar objeção\">\n      Use UM destes formatos:\n      \n      1. Pergunta que assume a venda:\n      \"Me conta, você prefere parcelar no cartão ou pagar à vista?\"\n      \"Qual seria o melhor dia do mês para você começar?\"\n      \"Você quer começar já neste mês ou prefere garantir vaga para o próximo?\"\n      \n      2. Provocação com consequência:\n      \"Quantos clientes você acha que vai deixar de atender enquanto fica sem esse conhecimento?\"\n      \"Quanto você acha que vale poder resolver um caso tributário de R$ 50 mil?\"\n      \n      3. Curiosidade com prova social:\n      \"Posso te mostrar o caso de algumas pessoas que estavam na mesma situação que você?\"\n      \"Quer ver como outros advogados resolveram exatamente esse problema?\"\n    </Contexto>\n\n    <Contexto tipo=\"Lead demonstra interesse mas não compra\">\n      Use UM destes formatos:\n      \n      1. Urgência gentil:\n      \"Esse lote fecha em breve. Quer que eu segure sua vaga enquanto você decide?\"\n      \"Restam apenas algumas vagas nesse valor. Posso separar uma para você?\"\n      \n      2. Quebra de risco:\n      \"Te envio o link agora e você garante o preço. Se mudar de ideia em 7 dias, a gente devolve. Que tal?\"\n      \n      3. Facilitação imediata:\n      \"Vou te mandar o link agora. Qualquer trava no pagamento, você me chama aqui que eu resolvo na hora. Fechado?\"\n    </Contexto>\n\n    <Contexto tipo=\"Lead faz pergunta técnica\">\n      Após responder, SEMPRE adicione:\n      \n      \"Isso responde sua dúvida? Te mostro mais alguma coisa específica?\"\n      \"Ficou claro? Qual outra parte do curso te interessa conhecer?\"\n      \"Entendeu? Quer que eu te mostre como aplicar isso na prática?\"\n    </Contexto>\n\n    <Contexto tipo=\"Lead está indeciso\">\n      Use perguntas que forçam reflexão:\n      \n      \"Me diz uma coisa: o que você precisa ver/saber para tomar a decisão hoje?\"\n      \"Se o curso tivesse (algo que ele mencionou), você entraria agora?\"\n      \"O que está te segurando de começar? É o valor, o conteúdo ou outra coisa?\"\n    </Contexto>\n\n    <Contexto tipo=\"Lead dá objeção fraca (desculpa)\">\n      Confronte gentilmente:\n      \n      \"Entendo... mas me responde com sinceridade: é realmente isso que voce falou ou você ainda não se sentiu seguro sobre o resultado?\"\n      \"Posso ser direto? isso que voce falou parece mais uma justificativa do que o real motivo. Me conta, o que te preocupa de verdade?\"\n    </Contexto>\n\n  </CTAsPorContexto>\n\n  <EstruturaObrigatoria>\n    TODA mensagem deve seguir este formato:\n    \n    [RESPOSTA/QUEBRA DE OBJEÇÃO - máx 400 caracteres]\n    \n    [CTA ESPECÍFICO - 1 pergunta ou provocação - máx 200 caracteres]\n    \n    Exemplo:\n    \"Entendo sua preocupação com tempo,{{ $item(\"0\").$node[\"camposIniciais\"].json[\"meta\"][\"nomeCliente\"].split(\" \")[0] }}. Mas o curso é 100% gravado, você assiste no seu ritmo. Tem gente que faz em 1h por semana e já está atuando.\n    \n    Me conta, você consegue separar 1h por semana ou precisa de algo mais flexível ainda?\"\n  </EstruturaObrigatoria>\n\n  <RegrasDeOuro>\n    1. Se o lead NÃO respondeu ao CTA anterior, mude a abordagem\n    2. Se já fez 2 perguntas seguidas sem resposta, use provocação\n    3. Se lead está evasivo, confronte gentilmente\n  </RegrasDeOuro>\n\n</CTAsObrigatorios>\n\n<InstrucoesSupremas prioridade=\"ABSOLUTA\">\n  \n  <Regra1>\n    Para QUALQUER mensagem que NÃO seja cumprimento/despedida:\n    PRIMEIRO → Acionar tool \"searchobjecoes\"\n    DEPOIS → Formular resposta baseada APENAS no retorno\n    NUNCA → Criar resposta sem consultar a tool\n  </Regra1>\n\n  <Regra2>\n    TODA resposta DEVE terminar com:\n    - UMA pergunta específica, OU\n    - UMA provocação curiosa, OU\n    - UM próximo passo claro\n    \n    NUNCA termine com frases genéricas tipo \"fico à disposição\"\n  </Regra2>\n\n  <Regra3>\n    Se o lead não responder após seu CTA:\n    - 1ª tentativa: Mude a abordagem (use pergunta diferente)\n    - 2ª tentativa: Use provocação/urgência\n  </Regra3>\n\n  <ValidacaoAutomatica>\n    Antes de enviar QUALQUER mensagem, pergunte-se:\n    ✓ Consultei a tool \"searchobjecoes\"? (Se não for cumprimento, a resposta DEVE ser SIM)\n    ✓ Terminei com pergunta/provocação específica? (DEVE ser SIM)\n    ✓ Usei CTAs proibidos? (DEVE ser NÃO)\n    \n    Se qualquer resposta estiver errada: REFAÇA a mensagem\n  </ValidacaoAutomatica>\n\n</InstrucoesSupremas>\n\n\n</IAConfig>\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "ad658beb-6ec6-4b8f-b95c-1b7e755bf5d5",
      "name": "Prompt_",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -5888,
        448
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "// Pega os dados dos nós anteriores\nconst camposIniciais = items[0].json;\nconst respostaIA = $input.item.json.output || $input.item.json.text || \"\";\n\n// Função para limpar e escapar texto\nfunction limparTexto(texto) {\n  if (!texto) return \"\";\n  \n  return String(texto)\n    .replace(/\\\\/g, '\\\\\\\\')     // Escapa barras invertidas primeiro\n    .replace(/\"/g, '\\\\\"')       // Escapa aspas duplas\n    .replace(/\\n/g, '\\\\n')      // Escapa quebras de linha\n    .replace(/\\r/g, '\\\\r')      // Escapa retorno de carro\n    .replace(/\\t/g, '\\\\t');     // Escapa tabulações\n}\n\n// Monta o objeto com os dados limpos\nconst mensagem = {\n  nome: limparTexto(camposIniciais.meta?.nomeCliente || \"Higor Leite\"),\n  telefone: String(camposIniciais.meta?.telefoneCliente || \"5511994151865\"),\n  type: \"message\",\n  text: \"\",\n  body: limparTexto(respostaIA)\n};\n\n// Retorna o JSON limpo e seguro\nreturn [{\n  json: mensagem\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1504,
        624
      ],
      "id": "bcb18d5e-9b32-4b8c-b318-4b9e674fcd49",
      "name": "Code3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2db4fa36-c506-4e4c-9f74-8ebe506d96cf",
              "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
              "rightValue": "5511984151865",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "b82c2f1e-c68b-456a-81e9-11a8ac3bfaae",
              "leftValue": "={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"contact\"][\"phoneNumber\"] }}",
              "rightValue": "553197909402",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -5472,
        1024
      ],
      "id": "01959f50-d656-4b8c-b4b8-cbbbc259e98f",
      "name": "Ativar para teste"
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "webhook.fabianatome.com.br",
            "user-agent": "axios/1.12.2",
            "content-length": "490",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "34.34.231.53",
            "x-forwarded-host": "webhook.fabianatome.com.br",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "55c61d0068b6",
            "x-real-ip": "34.34.231.53"
          },
          "params": {},
          "query": {},
          "body": {
            "contact": {
              "id": "01982acd-1f7b-70a7-adab-cdd4ad50b716",
              "name": "Marcos",
              "email": "contato@authlike.com",
              "phoneNumber": "5527998210071",
              "tags": "leads_naoalunos_jul25, TRA_SET_2025_LEAD",
              "fields": {
                "IA Resposta": "Alguma dúvida? 😊",
                "mensagem": "Oi! Como posso ajudar você hoje?"
              },
              "lastMessage": "Quero comprar a black vitalicia",
              "lastMessageData": {
                "message": "Quero comprar a black vitalicia",
                "messageType": "message"
              },
              "instaName": "",
              "profilePicUrl": ""
            },
            "event_date": 1763238557,
            "triggerData": {}
          },
          "webhookUrl": "https://webhook.fabianatome.com.br/webhook/vendasblack",
          "executionMode": "production"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-10-16T16:30:47.315Z",
      "createdAt": "2025-10-16T16:30:47.315Z",
      "role": "workflow:owner",
      "workflowId": "5AkZBvuxRdmbDm8f",
      "projectId": "tP5lcLj6t4StcK5B"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "updatedAt": "2025-07-28T18:40:41.569Z",
      "createdAt": "2025-07-28T18:40:41.569Z",
      "id": "MXdjGQQn0TxQ2tbH",
      "name": "IA"
    },
    {
      "updatedAt": "2025-08-01T15:01:01.059Z",
      "createdAt": "2025-08-01T15:01:01.059Z",
      "id": "pxsFvNO5bPBvSJZW",
      "name": "VENDAS"
    },
    {
      "updatedAt": "2025-08-21T20:51:48.346Z",
      "createdAt": "2025-08-21T20:51:48.346Z",
      "id": "ovUuYn0yxvhdOdZy",
      "name": "API OFICIAL"
    },
    {
      "updatedAt": "2025-10-16T16:31:26.022Z",
      "createdAt": "2025-10-16T16:31:26.022Z",
      "id": "W4SToZ7HBoKdaGAb",
      "name": "BLACK FRIDAY"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2026-01-02T17:56:18.855Z",
  "versionId": "e76dc650-ae94-4a44-8a21-cc2946f93f73"
}