{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Get a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders": {
      "main": [
        []
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a document": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-04T20:26:41.838Z",
  "id": "ISRpl911L1TatKi5",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "add Rag",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1120,
        1104
      ],
      "id": "7ed4905a-fa23-4afc-9cbb-103d1ed65b66",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        224,
        1328
      ],
      "id": "d89f70d1-abf1-4e63-80a5-dbbcc118c2fd",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "FWqn0IMXX1HmDrEh",
          "name": "IA SUPORTE"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $('Loop Over Items').item.json.texto }}",
        "textSplittingMode": "custom",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "Pergunta",
                "value": "={{ $('Loop Over Items').item.json.pergunta }}"
              },
              {
                "name": "Resposta ",
                "value": "={{ $('Loop Over Items').item.json.resposta }}"
              },
              {
                "name": "objecao",
                "value": "={{ $('Loop Over Items').item.json.tema }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        432,
        1344
      ],
      "id": "51a86922-6998-4bbc-9ede-0b0bc80aa503",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "info_captacao",
          "mode": "list",
          "cachedResultName": "info_captacao"
        },
        "options": {
          "queryName": "match_info_captacao"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        304,
        1168
      ],
      "id": "9f92345b-edab-4653-a585-c51891a40d00",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "06funpVK0RasJnc4",
          "name": "Supabase - Fabiana Tomé"
        }
      }
    },
    {
      "parameters": {
        "content": "## VETORIZADOR",
        "height": 620,
        "width": 2068,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1200,
        1024
      ],
      "typeVersion": 1,
      "id": "fd83b473-105e-4f7c-b1be-4ccbbf14ccf6",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "chunkSize": 26000,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        528,
        1488
      ],
      "id": "73c8253a-c167-4008-9de4-3f587847f577",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -176,
        1120
      ],
      "id": "2409a837-4396-4512-b4e1-c4f0d330b3a5",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        672,
        1168
      ],
      "id": "78389c6d-ceb1-44ba-9480-188dad7af9e7",
      "name": "Wait",
      "webhookId": "eb2139c1-1fc3-4aa3-8b0a-d7462a11c68d"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "1ywGXlc6E3Vc7WArLhBCdewsG5G3aiGe5",
            "mode": "list",
            "cachedResultName": "Modulo 26 -  LIVES EXCLUSIVAS (AULAS COMPLEMENTARES)",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1ywGXlc6E3Vc7WArLhBCdewsG5G3aiGe5"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -832,
        912
      ],
      "id": "a224e72c-009a-478d-abb2-ed841a5505d9",
      "name": "Search files and folders",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "2QobK2TUrQea7DlZ",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        32,
        1216
      ],
      "id": "8d97664f-c95c-4580-837b-2d799d3e5233",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "=1Ian6olRJNFpuDdUa8V-j56g_ECQNiju4-kuPg3cIQvc"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        -800,
        1104
      ],
      "id": "893d8c68-976d-4d55-ae0c-a2f13feb1f68",
      "name": "Get a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "u69VoKCm2y4Ogvjx",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// PARSER PARA PERGUNTAS E RESPOSTAS - FAQ TRIBUTARISTA\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const documentId = item.json.documentId || null;\n  const content = item.json.content || '';\n  \n  const linhas = content.split('\\n');\n  \n  let tema = null;\n  let pergunta = null;\n  let resposta = '';\n  let capturandoResposta = false;\n  let contador = 1;\n  \n  for (let i = 0; i < linhas.length; i++) {\n    const linha = linhas[i].trim();\n    \n    if (!linha) {\n      if (capturandoResposta && resposta && tema && pergunta) {\n        let proximaLinhaIndex = i + 1;\n        while (proximaLinhaIndex < linhas.length && !linhas[proximaLinhaIndex].trim()) {\n          proximaLinhaIndex++;\n        }\n        \n        if (proximaLinhaIndex < linhas.length) {\n          const proximaLinha = linhas[proximaLinhaIndex].trim();\n          if (!proximaLinha.includes('\"') && !proximaLinha.startsWith('Resposta:')) {\n            const textoCompleto = `Pergunta: ${pergunta}\\n\\nResposta: ${resposta.trim()}`;\n            \n            results.push({\n              json: {\n                documentId: documentId,\n                qaId: `QA_${String(contador).padStart(3, '0')}`,\n                tema: tema,\n                pergunta: pergunta,\n                resposta: resposta.trim(),\n                texto: textoCompleto,\n                source: \"faq\",\n                blobType: \"text/plain\",\n                metadata: {\n                  tipo: \"pergunta_resposta\",\n                  categoria: tema,\n                  ordem: contador\n                }\n              }\n            });\n            contador++;\n            tema = null;\n            pergunta = null;\n            resposta = '';\n            capturandoResposta = false;\n          }\n        }\n      }\n      continue;\n    }\n    \n    if (!capturandoResposta && !linha.includes('\"') && !linha.startsWith('Resposta:')) {\n      if (tema && pergunta && resposta) {\n        const textoCompleto = `Pergunta: ${pergunta}\\n\\nResposta: ${resposta.trim()}`;\n        \n        results.push({\n          json: {\n            documentId: documentId,\n            qaId: `QA_${String(contador).padStart(3, '0')}`,\n            tema: tema,\n            pergunta: pergunta,\n            resposta: resposta.trim(),\n            texto: textoCompleto,\n            source: \"faq\",\n            blobType: \"text/plain\",\n            metadata: {\n              tipo: \"pergunta_resposta\",\n              categoria: tema,\n              ordem: contador\n            }\n          }\n        });\n        contador++;\n        pergunta = null;\n        resposta = '';\n      }\n      tema = linha;\n    }\n    \n    else if (linha.includes('\"')) {\n      const match = linha.match(/\"([^\"]+)\"/);\n      if (match) {\n        pergunta = match[1].trim();\n      }\n    }\n    \n    else if (linha.startsWith('Resposta:')) {\n      resposta = linha.replace(/^Resposta:\\s*/, '');\n      capturandoResposta = true;\n    }\n    \n    else if (capturandoResposta) {\n      resposta += '\\n' + linha;\n    }\n  }\n  \n  if (tema && pergunta && resposta) {\n    const textoCompleto = `Pergunta: ${pergunta}\\n\\nResposta: ${resposta.trim()}`;\n    \n    results.push({\n      json: {\n        documentId: documentId,\n        qaId: `QA_${String(contador).padStart(3, '0')}`,\n        tema: tema,\n        pergunta: pergunta,\n        resposta: resposta.trim(),\n        texto: textoCompleto,\n        source: \"faq\",\n        blobType: \"text/plain\",\n        metadata: {\n          tipo: \"pergunta_resposta\",\n          categoria: tema,\n          ordem: contador\n        }\n      }\n    });\n  }\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -448,
        1104
      ],
      "id": "86140b6a-2646-4791-8625-7764a84594c2",
      "name": "Code"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-08-04T20:26:41.838Z",
      "createdAt": "2025-08-04T20:26:41.838Z",
      "role": "workflow:owner",
      "workflowId": "ISRpl911L1TatKi5",
      "projectId": "tP5lcLj6t4StcK5B"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2026-01-12T20:01:54.599Z",
  "versionId": "c7949eeb-edb7-4970-bd70-3e37652666e9"
}